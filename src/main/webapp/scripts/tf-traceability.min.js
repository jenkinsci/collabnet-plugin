angular.module("tfTraceability",["ngCookies","ui.bootstrap"]);(function(){var resources={date:"Date",by:"By",id:"ID",source:"Source",status:"Status",summary:"Summary",setAsTarget:"Set As Target",remove:"Remove",add:"Add",limitExceeded:"Too many associations for display; some older results may not be shown.",noAssociations:"No Associations",confirmDel:"Do you want to remove the selected association(s)?",addingAssociation:"Adding association...",removingAssociation:"Removing association...",selectAll:"Select all associations",select:"Select",association:"association",removeAssociationAlert:"There was a problem removing associations",CommitSummary:"Commit",WorkItemSummary:"Work Item",BuildSummary:"Build",ReviewRequestSummary:"Review Request",CustomSummary:"Custom Type",none:"No Associations",at:"At",seeActivity:"See Activity",seeCommit:"See Commit",seeWorkItem:"See Work Item",seeBuildResults:"See Build Results",seeReviewRequest:"See Review Request",jumpTo:"Jump To",comment:"Comment",priority:"Priority",initiatedBy:"Initiated By",duration:"Duration",seconds:"seconds",results:"Results",ignored:"ignored",failed:"failed",passed:"passed",dependencies:"Show Artifact Dependencies"};angular.module("tfTraceability").factory("tfBundleEn",[function(){return resources}])})();(function(){var resources={date:"日付",by:"登録者",id:"ID",source:"ソース",status:"状態",summary:"概要",setAsTarget:"ターゲットに設定",remove:"削除",add:"追加",limitExceeded:"関連付けが多すぎるので、古い関連付けは表示されていない可能性があります。",noAssociations:"関連付けなし",confirmDel:"選択した関連付けを削除しますか?",addingAssociation:"関連付けを追加中...",removingAssociation:"関連付けを削除中...",selectAll:"すべての関連付けを選択",select:"選択",association:"関連付け",removeAssociationAlert:"関連付けの削除に問題がありました。",CommitSummary:"コミット",WorkItemSummary:"ワークアイテム",BuildSummary:"ビルド",ReviewRequestSummary:"レビューリクエスト",CustomSummary:"カスタムタイプ",none:"関連付けなし",at:"At",seeActivity:"アクティビティを参照",seeCommit:"コミットを参照",seeWorkItem:"アイテムを参照",seeBuildResults:"ビルド結果を参照",seeReviewRequest:"レビューリクエストを参照",jumpTo:"移動",comment:"コメント",priority:"優先度",initiatedBy:"Initiated By",duration:"実行時間",seconds:"秒",results:"結果",ignored:"ignored",failed:"failed",passed:"passed",dependencies:"Show Artifact Dependencies"};angular.module("tfTraceability").factory("tfBundleJa",[function(){return resources}])})();(function(){var resources={date:"날짜",by:"등록자",id:"아이디",source:"소스",status:"상태",summary:"요약",setAsTarget:"대상으로 설정",remove:"제거",add:"추가",limitExceeded:"표시해야할 연결 항목이 너무 많아서 오래된 연결항목은 표시되지 않을 수 있습니다.",noAssociations:"No Associations",confirmDel:"Do you want to remove the selected association(s)?",addingAssociation:"Adding association...",removingAssociation:"Removing association...",selectAll:"Select all associations",select:"Select",association:"association",removeAssociationAlert:"There was a problem removing associations",CommitSummary:"Commit",WorkItemSummary:"Work Item",BuildSummary:"Build",ReviewRequestSummary:"Review Request",CustomSummary:"Custom Type",none:"No Associations",at:"At",seeActivity:"See Activity",seeCommit:"See Commit",seeWorkItem:"See Work Item",seeBuildResults:"See Build Results",seeReviewRequest:"See Review Request",jumpTo:"Jump To",comment:"Comment",priority:"Priority",initiatedBy:"Initiated By",duration:"Duration",seconds:"seconds",results:"Results",ignored:"ignored",failed:"failed",passed:"passed",dependencies:"Show Artifact Dependencies"};angular.module("tfTraceability").factory("tfBundleKo",[function(){return resources}])})();(function(){var resources={date:"Date",by:"By",id:"ID",source:"Source",status:"Status",summary:"Summary",setAsTarget:"Set As Target",remove:"Remove",add:"Add",limitExceeded:"Too many associations for display; some older results may not be shown.",noAssociations:"No Associations",confirmDel:"Do you want to remove the selected association(s)?",addingAssociation:"Adding association...",removingAssociation:"Removing association...",selectAll:"Select all associations",select:"Select",association:"association",removeAssociationAlert:"There was a problem removing associations",CommitSummary:"Commit",WorkItemSummary:"Work Item",BuildSummary:"Build",ReviewRequestSummary:"Review Request",CustomSummary:"Custom Type",none:"No Associations",at:"At",seeActivity:"See Activity",seeCommit:"See Commit",seeWorkItem:"See Work Item",seeBuildResults:"See Build Results",seeReviewRequest:"See Review Request",jumpTo:"Jump To",comment:"Comment",priority:"Priority",initiatedBy:"Initiated By",duration:"Duration",seconds:"seconds",results:"Results",ignored:"ignored",failed:"failed",passed:"passed",dependencies:"Show Artifact Dependencies"};angular.module("tfTraceability").factory("tfBundleZh",[function(){return resources}])})();(function(){var navigator;var bundles={};angular.module("tfTraceability").factory("tfI18nService",["$window","tfBundleEn","tfBundleJa","tfBundleKo","tfBundleZh",function($window,tfBundleEn,tfBundleJa,tfBundleKo,tfBundleZh){navigator=$window.navigator;bundles.en=tfBundleEn;bundles.ja=tfBundleJa;bundles.ko=tfBundleKo;bundles.zh=tfBundleZh;return{translate:translate}}]);function translate(key){if(!key)return"";var lang=navigator.userLanguage||navigator.language;lang=lang&&lang.length>=2?lang.substring(0,2):"en";var bundle=bundles[lang];if(!bundle){bundle=bundles.en}var result=bundle[key];if(!result){result=bundles.en[key]}if(!result){console.log("Translation error for key",key);result=key}return result}})();(function(){angular.module("tfTraceability").factory("tfLocalStorageService",["$window","$rootScope",function($window,$rootScope){return{setData:function(key,val){if($window.localStorage){var storedObjStr=$window.localStorage.getItem("tf-traceability-storage");var storedObj=!storedObjStr?{}:JSON.parse(storedObjStr)||{};if(!storedObj[key]||storedObj[key]!==val){storedObj[key]=val;$window.localStorage.setItem("tf-traceability-storage",JSON.stringify(storedObj))}}return this},getData:function(key){if($window.localStorage){var storedObjStr=$window.localStorage.getItem("tf-traceability-storage");var storedObj=!storedObjStr?{}:JSON.parse(storedObjStr)||{};if(storedObj.hasOwnProperty(key)){return storedObj[key]}}return undefined}}}])})();(function(){angular.module("tfTraceability").provider("tfQueryService",tfQueryServiceProvider);var timeaxisdata={};var restResponse=null;var maxCtfAssociationsPerRequest=500;function tfQueryServiceProvider(){this.$get=["$http","$q","$rootScope","$injector","tfUtilService","tfLocalStorageService","tfRestApiService",function($http,$q,$rootScope,$injector,tfUtil,tfStorage,tfRestApi){var widgetsNotificationService=null;try{widgetsNotificationService=$injector.get("widgetsNotificationService")}catch(e){}return{fetchNthLevelAssociations:function(args){var key=makeKey(args);performQueryIfRequired($http,$q,tfUtil,tfStorage,tfRestApi,widgetsNotificationService,key,args,$rootScope);return key},cache:function(args){return ensureCache($q,tfUtil,tfStorage,tfRestApi,widgetsNotificationService,args)},getRestResponse:function(){return restResponse},getTimeAxisData:function(){return timeaxisdata},clearCache:clearCache,getKey:makeKey,isEditableAssociations:function(item){return item&&(item.path||ctfObjectId(item)!==null)&&!item.deleted&&(restResponse&&(!restResponse.hasOwnProperty("associationCount")||!!item.canEdit))}}}]}var semaphore={};function ensureCache($q,util,tfStorage,restapi,widgetsNotificationService,args){var key=makeKey(args);if(semaphore.hasOwnProperty(key))return;semaphore[key]=true;var level=args.levelNum;var levelIds=restResponse?restResponse.getLevelIds(level):null;var levelCached=levelIds!=null;var nextLevelIds=null;if(args.readNextLevel){nextLevelIds=restResponse?restResponse.getLevelIds(level+1):null}var callServer=true;var nextLevelCached=nextLevelIds!=null;if(levelCached&&(!args.readNextLevel||nextLevelCached)){callServer=false}if(callServer){var ids=[];var depth=0;if(level>0){var fetchAssociationsForLevelInt=levelCached?level:level-1;depth=levelCached?0:args.readNextLevel?1:0;var fetchAssociationsForObjectIds=null;if(levelCached){fetchAssociationsForObjectIds=levelIds}else{fetchAssociationsForObjectIds=restResponse?restResponse.getLevelIds(fetchAssociationsForLevelInt):null}if(fetchAssociationsForObjectIds==null){delete semaphore[key];callServer=false}if(callServer){if(fetchAssociationsForObjectIds.length==0){restResponse.levels[(fetchAssociationsForLevelInt+1).toString()]=[];delete semaphore[key];callServer=false}ids=fetchAssociationsForObjectIds}}else{var id=args.remoteId;if(args.sourceType!=="teamforge"){id=args.remoteSource+":"+args.remoteId}ids.push(id)}}if(callServer){return performRestQuery(ids,depth,util,tfStorage,restapi,widgetsNotificationService,args).then(function(response){delete semaphore[key];return key})}var deferred=$q.defer();deferred.resolve(key);return deferred.promise}function performQueryIfRequired($http,$q,util,tfStorage,restapi,widgetsNotificationService,key,args,$rootScope){if(semaphore.hasOwnProperty(key))return;semaphore[key]=true;var level=args.levelNum;var levelIds=restResponse?restResponse.getLevelIds(level):null;var levelCached=levelIds!=null;var nextLevelIds=null;if(args.readNextLevel){nextLevelIds=restResponse?restResponse.getLevelIds(level+1):null}var nextLevelCached=nextLevelIds!=null;if(levelCached&&(!args.readNextLevel||nextLevelCached)){broadcast($rootScope,key);return}if(level===0){clearCache()}var ids=[];var depth=0;if(level>0){var fetchAssociationsForLevelInt=levelCached?level:level-1;depth=levelCached?0:args.readNextLevel?1:0;var fetchAssociationsForObjectIds=null;if(levelCached){fetchAssociationsForObjectIds=levelIds}else{fetchAssociationsForObjectIds=restResponse?restResponse.getLevelIds(fetchAssociationsForLevelInt):null}if(fetchAssociationsForObjectIds==null){delete semaphore[key];return}if(fetchAssociationsForObjectIds.length==0){restResponse.levels[(fetchAssociationsForLevelInt+1).toString()]=[];broadcast($rootScope,key);return}ids=fetchAssociationsForObjectIds}else{var id=args.remoteId;if(args.sourceType!=="teamforge"){id=args.remoteSource+":"+args.remoteId}ids.push(id)}performRestQuery(ids,depth,util,tfStorage,restapi,widgetsNotificationService,args).then(function(response){broadcast($rootScope,key)}).catch(function(error){broadcast($rootScope,key)})}function performRestQuery(ids,depth,util,tfStorage,restapi,widgetsNotificationService,args){var includeEvents=!util.getVal("disableOrc");var includeDependencies=tfStorage.getData("include-dependencies");if(widgetsNotificationService){widgetsNotificationService.tick()}return restapi.getAssociations(ids,depth,args,includeEvents,includeDependencies).then(function(response){var attachFunctions=false;var restResults=response.data;if(restResults){if(widgetsNotificationService&&Array.isArray(restResults.errors)){angular.forEach(restResults.errors,function(error){if(error&&error.message){widgetsNotificationService.addHtmlErrorNotification(error.message,1)}})}var startLevel=0;if(restResponse){startLevel=restResponse.merge(restResults)}else{restResponse=restResults;attachFunctions=true}}if(!restResponse){restResponse={};attachFunctions=true}if(!restResponse.objectSummaries){restResponse.objectSummaries={}}if(attachFunctions){attachHelperFunctions(restResponse)}processRestResults(util,args.ctfUrl,restResponse,startLevel)}).catch(function(error){console.log("Error retrieving data or no data found (rest)");console.log(error)})}function processRestResults(util,ctfUrl,restData,startLevel){var objectSummaries=restData.objectSummaries;if(objectSummaries){if(restData.levels){for(var levelStr in restData.levels){var levelInt=+levelStr;if(levelInt>=startLevel){if(restData.levels.hasOwnProperty(levelStr)){var levelIds=restData.levels[levelStr];levelIds.forEach(function(objectId){if(objectSummaries.hasOwnProperty(objectId)){var d=objectSummaries[objectId];d.__massaged_date=util.getInternalDateString(d.createdDate);d.__display_time=util.getTimeString(d.createdDate);d.__display_date=util.getDateString(d.createdDate);if(d._links){if(d._links.hasOwnProperty("icon")){d.__icon_url=util.getMassagedUrl(ctfUrl,d._links.icon.href)}if(d._links.hasOwnProperty("remoteUrl")){d.__remote_link=util.getMassagedUrl(ctfUrl,d._links.remoteUrl.href)}}d.level=levelInt}})}}}}}buildVisualData(util,restData)}function buildVisualData(util,restData){var combination=[];var objectSummaries=restData.objectSummaries;if(objectSummaries){for(var objectId in objectSummaries){if(objectSummaries.hasOwnProperty(objectId)){var d=objectSummaries[objectId];combination.push(d)}}}var combination_pre_origin=[];var combination_post_origin=[];if(combination.length>0){combination.sort(function(a,b){return new Date(a.createdDate)-new Date(b.createdDate)});var zeroLevelIds=restData.getLevelIds(0);var origin_node=restData.objectSummaries[zeroLevelIds[0]];var origin_node_date=new Date(origin_node.createdDate);combination.forEach(function(node){if(new Date(node.createdDate)<origin_node_date){combination_pre_origin.push(node)}else{combination_post_origin.push(node)}})}var svgWidth=util.getVal("svgWidth")||1e3;var x,massaged_date,initialOffset=+svgWidth/2;if(combination_pre_origin.length===0){initialOffset=50}else if(combination_post_origin.length===0&&combination_pre_origin.length*30>+svgWidth/3){initialOffset=+svgWidth-100}else{initialOffset=+svgWidth/2}timeaxisdata={};timeaxisdata.post_origin={};timeaxisdata.pre_origin={};var minX=50,maxX=50;combination_post_origin.forEach(function(node){massaged_date=node.__massaged_date;node.cy=node.level===0?120:(node.level+1)*100;if(massaged_date in timeaxisdata.post_origin){if(node.level===0){x=initialOffset;node.cx=x}else{x=x+50;node.cx=x}}else{if(node.level===0){x=initialOffset;node.cx=x}else{x=x+70;node.cx=x}node.cx=timeaxisdata.post_origin[massaged_date]=x}maxX=node.cx});x=initialOffset;combination_pre_origin.reverse().forEach(function(node){massaged_date=node.__massaged_date;node.cy=node.level===0?120:(node.level+1)*100;if(massaged_date in timeaxisdata.pre_origin){x=x-50;node.cx=x=timeaxisdata.pre_origin[massaged_date]=x}else{x=x-70;node.cx=timeaxisdata.pre_origin[massaged_date]=x}minX=node.cx});util.setVal("minX",minX);util.setVal("maxX",maxX)}function attachHelperFunctions(restResults){if(restResults){restResults.hasDependencyAssociations=function hasDependencyAssociations(){for(var summaryId in this.associations){var ids=this.getAssociatedObjectIds(summaryId,"parentAssociations");if(ids.length==0){ids=this.getAssociatedObjectIds(summaryId,"childAssociations")}if(ids.length>0){return true}}return false};restResults.isAssociated=function isAssociated(originObjectId,targetObjectId,associationType){var allAssociations=null;if(this.associations&&this.associations.hasOwnProperty(originObjectId)){allAssociations=this.associations[originObjectId]}var result=false;if(allAssociations){var parents=allAssociations.parentAssociations;if(parents&&(!associationType||associationType==="parentAssociations")){result=parents.hasOwnProperty(targetObjectId)}if(!result){var children=allAssociations.childAssociations;if(children&&(!associationType||associationType==="childAssociations")){result=children.hasOwnProperty(targetObjectId)}if(!result){var generics=allAssociations.genericAssociations;if(generics&&(!associationType||associationType==="genericAssociations")){result=generics.hasOwnProperty(targetObjectId)}}}}return result};restResults.getAssociatedObjectIds=function getAssociatedObjects(objectId,associationType){var allAssociations=null;if(this.associations&&this.associations.hasOwnProperty(objectId)){allAssociations=this.associations[objectId]}var associatedToIds=[];if(allAssociations){var parents=allAssociations.parentAssociations;if(parents&&(!associationType||associationType==="parentAssociations")){for(var associatedToId in parents){associatedToIds.push(associatedToId)}}var children=allAssociations.childAssociations;if(children&&(!associationType||associationType==="childAssociations")){for(var associatedToId in children){associatedToIds.push(associatedToId)}}var generics=allAssociations.genericAssociations;if(generics&&(!associationType||associationType==="genericAssociations")){for(var associatedToId in generics){associatedToIds.push(associatedToId)}}}return associatedToIds};restResults.getAssociatedObjects=function getAssociatedObjects(objectId,associationType){var associatedToIds=this.getAssociatedObjectIds(objectId,associationType);return this.toObjectSummaryList(associatedToIds)};restResults.getLevelIds=function getLevelIds(level){var result=null;if(this.hasOwnProperty("levels")){var levelStr=level.toString();if(this.levels.hasOwnProperty(levelStr)){result=this.levels[levelStr]}}return result};restResults.getLevelObjects=function getLevelObjects(level){var levelIds=this.getLevelIds(level);return this.toObjectSummaryList(levelIds)};restResults.toObjectSummaryList=function toObjectSummaryList(idList){var result=[];if(idList){var idIndex,idListLength;for(idIndex=0,idListLength=idList.length;idIndex<idListLength;idIndex++){var objectId=idList[idIndex];var associatedToObject=this.objectSummaries[objectId];result.push(associatedToObject)}}return result};restResults.getAssociationCount=function getAssociationCount(originId,targetId,associationType){var result=0;var allAssociations=null;if(this.associations&&this.associations.hasOwnProperty(originId)){allAssociations=this.associations[originId]}if(allAssociations){if(!associationType||associationType==="parentAssociations"){var parents=allAssociations.parentAssociations;if(parents){if(parents.hasOwnProperty(targetId)){result+=1}}}if(!associationType||associationType==="childAssociations"){var children=allAssociations.childAssociations;if(children){if(children.hasOwnProperty(targetId)){result+=1}}}if(!associationType||associationType==="genericAssociations"){var generics=allAssociations.genericAssociations;if(generics){if(generics.hasOwnProperty(targetId)){if(generics[targetId].hasOwnProperty("infos")){result+=generics[targetId].infos.length}else{result+=1}}}}}return result};restResults.merge=function merge(nextResponse){var mergedAt=-1;if(nextResponse&&nextResponse.levels){var existingLevelIds=[];var lastLevelKey=null;if(this.levels){for(var levelKey in this.levels){existingLevelIds=existingLevelIds.concat(this.levels[levelKey]);lastLevelKey=levelKey}}var lastLevelIds=lastLevelKey?this.levels[lastLevelKey]:[];var newFirstLevelIds=nextResponse.levels["0"];var mergeable=!lastLevelKey||lastLevelIds.length==newFirstLevelIds.length;if(mergeable){var levelObjIdInd;for(levelObjIdInd=0;levelObjIdInd<lastLevelIds.length;levelObjIdInd++){if(newFirstLevelIds.indexOf(lastLevelIds[levelObjIdInd])<0){mergeable=false;break}}}if(mergeable){if(!this.objectSummaries){this.objectSummaries={}}for(var objectId in nextResponse.objectSummaries){if(!this.objectSummaries.hasOwnProperty(objectId)){this.objectSummaries[objectId]=nextResponse.objectSummaries[objectId]}}if(!this.associations){this.associations={}}for(var objectId in nextResponse.associations){if(!this.associations.hasOwnProperty(objectId)){this.associations[objectId]=nextResponse.associations[objectId]}}var levelOffset=lastLevelKey?+lastLevelKey:0;for(var level in nextResponse.levels){var levelInt=+level;if(levelInt==0&&lastLevelKey){continue}var levelIds=nextResponse.levels[level];var newLevelIds=levelIds.filter(function(anId){return existingLevelIds.indexOf(anId)<0});var newLevelInt=levelInt+levelOffset;this.levels[newLevelInt.toString()]=newLevelIds;if(mergedAt<0){mergedAt=newLevelInt}}}}return mergedAt}}}function ctfObjectId(item){var objId=null;if(item.teamForgeId){objId=item.teamForgeId}return objId}function isUnique(arr,str){var isUniqueResult=true;for(var i=0;i<arr.length&&isUniqueResult;i++){if(str==arr[i]){isUniqueResult=false}}return isUniqueResult}function pushIfUnique(arr,str){var isUniqueResult=isUnique(arr,str);if(isUniqueResult){arr.push(str)}return isUniqueResult}function broadcast($rootScope,key){delete semaphore[key];$rootScope.$broadcast("timeaxisdata",timeaxisdata);$rootScope.$broadcast(key,true)}function mergeInfo(obj1,obj2){var prop;if(obj2){for(prop in obj2){if(obj2.hasOwnProperty(prop)&&!obj1[prop]){obj1[prop]=obj2[prop]}}}}function emptyData($q){var deferred=$q.defer();deferred.resolve({data:{items:[]}});return deferred.promise}function makeKey(obj,levelOffset){levelOffset=levelOffset||0;var level=parseInt(obj.levelNum)+parseInt(levelOffset);return level+":"+obj.remoteSource+":"+obj.remoteId}function clearCache(){timeaxisdata={};restResponse=null}})();(function(){"use strict";var theModule=angular.module("tfTraceability");theModule.service("tfRestApiService",["$q","$http","$window",function($q,$http,$window){function getAssociations(originIds,depth,args,includeEvents,includeDependencies){var isIncludeEvents=includeEvents?"true":"false";var isIncludeDependencies=includeDependencies?"true":"false";var ctfUrl=args.ctfUrl?args.ctfUrl:"";if(ctfUrl.indexOf("/",ctfUrl.length-1)>=0){ctfUrl=ctfUrl.slice(0,-1)}return $http({method:"GET",url:ctfUrl+"/ctfrest/foundation/v1/associations?ids="+originIds.join(",")+"&depth="+depth+"&includeActivities="+isIncludeEvents+"&includeDependencies="+isIncludeDependencies,headers:{Authorization:"Bearer "+args.token}})}function removeAssociations(originId,targetIds,args){var promises=[];angular.forEach(targetIds,function(targetId){promises.push(removeAssociation(originId,targetId,args))});return $q.all(promises).then(function(errors){var errorMsg=null;if(errors){var i=0;angular.forEach(errors,function(anError){if(anError){if(errorMsg){errorMsg+="\n"}else{errorMsg="There were problems removing associations:\n"}if(anError.message){errorMsg+=anError.message}else{var targetId=targetIds[i];errorMsg+=targetId}}i++})}return errorMsg})}function removeAssociation(originId,targetId,args){var ctfUrl=args.ctfurl?args.ctfurl:"";if(ctfUrl.indexOf("/",ctfUrl.length-1)>=0){ctfUrl=ctfUrl.slice(0,-1)}var useOriginId=originId;var useTargetId=targetId;var ids=useTargetId.split("_");if(ids&&ids.length>1){useOriginId=ids[0];useTargetId=ids[1]}return $http({method:"DELETE",url:ctfUrl+"/ctfrest/foundation/v1/objects/"+useOriginId+"/associations/"+useTargetId,headers:{Authorization:"Bearer "+args.token},handledStatusCodes:[403]}).then(function(response){return getErrorEntity(response)},function(response){return getErrorEntity(response)})}function getErrorEntity(response){var error=null;if(response){if(response.data){if(response.data.hasOwnProperty("_type")&&response.data._type==="error"){error=response.data}}}return error}return{removeAssociations:removeAssociations,getAssociations:getAssociations}}])})();(function(){angular.module("tfTraceability").factory("tfUtilService",[function(){return{configureDragForNodes:configureDragForNodes,configureSizeInSVG:configureSizeInSVG,configureZoomInSVG:configureZoomInSVG,connectNodes:connectNodes,connectNodesByIds:connectNodesByIds,drawNode:drawNode,getCanonicalType:getCanonicalType,getStatusIcon:getStatusIcon,getStatusColor:getStatusColor,getStatusFromObject:getStatusFromObject,getStatusNameFromObject:getStatusNameFromObject,getCustomNameFromFieldName:getCustomNameFromFieldName,fetchLevelN:fetchLevelN,makeKeyForLevelN:makeKeyForLevelN,htmlEncode:htmlEncode,showChevrons:showChevrons,setTimeFormat:setTimeFormat,setDateFormat:setDateFormat,setTimeZone:setTimeZone,getDateString:getDateString,getTimeString:getTimeString,getInternalDateString:getInternalDateString,moveElement:moveElement,isMaxLevelNodes:isMaxLevelNodes,startsWith:startsWith,endsWith:endsWith,getMassagedUrl:getMassagedUrl,escapeCSSNotationCharacters:escapeCSSNotationCharacters,setVal:setVal,getVal:getVal}}]);var parentDependencyColor="#5f47f7";var selectedColor="#3dade0";var unSelectedColor="#adbcc4";var kvPair={};var dateFormat="MMM D YYYY",timeFormat="h:mm a",timeZone="GMT",internalDateFormat="MMM DD YYYY";var usingMoment=(moment&&moment.tz)!==undefined;function configureSizeInSVG(svg,w,h){svg.attr("width",w).attr("height",h)}function configureDragForNodes(svg,group){var drag=d3.behavior.drag().on("drag",function(){var viewBoxX=getCurrentViewboxX();var radius=20;var maxX=getVal("maxX")||50,minX=getVal("minX")||50,svgWidth=parseInt(d3.select("svg#tf-explore-svg").style("width"));var x=viewBoxX-d3.event.dx;if(x>maxX-100||x<minX+100+2*radius-svgWidth)return;showChevrons(svg);viewBoxX=x;group.attr("transform","translate("+-viewBoxX+","+"0)");d3.select(group.node().parentNode).selectAll("g.dates").attr("transform","translate("+-viewBoxX+","+"0)")});svg.call(drag);svg.on("mouseover",function(){showChevrons(svg)}).on("mousedown",function(){svg.style("cursor","move")}).on("mouseup",function(){svg.style("cursor","default")})}function configureZoomInSVG(svg,group){var zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){group.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")});svg.call(zoom)}function showChevrons(svg){var _clickChevron=function(shift){d3.selectAll("g#tf-explore-levels").attr("transform","translate("+shift+", 0)");d3.selectAll("g#tf-explore-dates").attr("transform","translate("+shift+", 0)");showChevrons(svg)};var x=getCurrentViewboxX();var str=d3.select("svg#tf-explore-svg").style("width");var svgWidth=str.indexOf("px")>0?parseInt(str):1e5;var radius=20,maxX=getVal("maxX")||50,minX=getVal("minX")||50;var moreRight=svgWidth+x<maxX+radius,moreLeft=x>minX-radius;var showChevron=moreLeft?"block":"none";d3.select(".tf-left-chevron").style("top","70px").style("display",showChevron).on("mousedown",function(){_clickChevron(d3.transform(d3.select("g#tf-explore-levels").attr("transform")).translate[0]+100)});showChevron=moreRight?"block":"none";d3.select(".tf-right-chevron").style("top","70px").style("right","0px").style("display",showChevron).on("mousedown",function(){_clickChevron(d3.transform(d3.select("g#tf-explore-levels").attr("transform")).translate[0]-100)})}function getCurrentViewboxX(){var t=d3.select("g#tf-explore-levels").attr("transform");return t?parseInt(t.substr(t.indexOf("(")+1))*-1:0}function includePatterns(svg,image){var imgPattern=getIdForPattern(svg,image);var ns=svg.ns;var defs=d3.select("g#tf-"+ns+"-levels defs");if(defs.selectAll("pattern#"+imgPattern)[0].length>0)return;var pattern=defs.append("svg:pattern").attr("x",0).attr("y",0).attr("width",16).attr("height",16).attr("id",imgPattern);pattern.append("image").attr("xlink:href",image).attr("x",12).attr("y",11).attr("height",15).attr("width",16)}function drawNode(svg,x,y,r,opts){if(opts.selected&&!opts.stroke){opts.stroke=selectedColor;opts.mouseoutstroke=selectedColor}var nodeId=opts.id;var escapedNodeId=escapeCSSNotationCharacters(nodeId);d3.selectAll("g#"+escapedNodeId+"_group").remove();d3.selectAll("text#"+escapedNodeId+"_text").remove();d3.selectAll("circle#"+escapedNodeId).remove();d3.selectAll("circle#"+escapedNodeId+"_status_circle").remove();d3.selectAll("text#"+escapedNodeId+"_status_text").remove();d3.selectAll("rect#"+escapedNodeId+"_count_rect").remove();d3.selectAll("text#"+escapedNodeId+"_count_text").remove();d3.selectAll("path."+escapedNodeId).remove();if(opts.image)includePatterns(svg,opts.image);var group=svg.append("g").attr("id",nodeId+"_group").attr("transform","translate("+x+","+y+")");if(opts.text){group.append("text").attr("id",nodeId+"_text").attr("stroke",unSelectedColor).attr("text-anchor","middle").attr("x",0).attr("y",5).style("font-size","14px").text(opts.text)}group.append("circle").attr("cx",0).attr("cy",0).attr("r",r).attr("id",nodeId).attr("class","node "+"tf_level_"+opts.level).style("stroke",opts.stroke?opts.stroke:unSelectedColor).style("stroke-width",opts.strokewidth?opts.strokewidth:"1px").style("fill",function(){return opts.image?getPatternUrl(getIdForPattern(svg,opts.image)):"#ffffff"}).style("fill-opacity",function(){return opts.image?1:0}).on("mouseover",function(){d3.select(this).style("stroke",opts.mouseoverstroke?opts.mouseoverstroke:selectedColor);if(opts.onClickIcon||opts.onClickFun||opts.hasOwnProperty("showDetailFun")){d3.select(this).style("cursor","pointer")}}).on("mouseout",function(){d3.select(this).style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:unSelectedColor);d3.selectAll("circle.selected").style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:selectedColor)}).on("mousedown",function(){d3.selectAll("circle.node").style("stroke",opts.mouseoverstroke?opts.mouseoverstroke:unSelectedColor).classed("selected",false).on("mouseout",function(){d3.select(this).style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:unSelectedColor);d3.selectAll("circle.selected").style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:selectedColor)}).on("click",function(){if(opts.onClickIcon){opts.onClickIcon(opts.group)}});d3.select(this).style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:selectedColor).classed("selected",true);d3.selectAll("path.link").style("stroke",opts.mouseoverstroke?opts.mouseoverstroke:unSelectedColor);d3.selectAll("path."+escapedNodeId).style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:selectedColor);d3.selectAll("path.parent"+escapedNodeId).style("stroke",opts.mouseoutstroke?opts.mouseoutstroke:parentDependencyColor);d3.selectAll("path."+escapedNodeId).each(function(){this.parentNode.appendChild(this)});if(opts.hasOwnProperty("showDetailFun"))opts.showDetailFun(nodeId)}).append("svg:title").text(opts.toolTip);if(opts.status)drawStatusIcon(svg,x,y,r,45,opts.status,opts.onClickIcon,nodeId);if(opts.hasOwnProperty("count"))drawCountIcon(svg,x,y,r,45,opts.count,nodeId);if(opts.onClickFun)drawExpandIcon(svg,x,y,r,315,opts)}function drawStatusIcon(svg,x,y,r,angle,status,onClickIcon,id){var point=findPointOnCircumference(x,y,r,angle);svg.append("circle").attr("id",id+"_status_circle").attr("cx",point.x+2).attr("cy",point.y).attr("r",5).style("stroke","white").style("fill","white").on("click",function(){if(onClickIcon){onClickIcon()}});svg.append("text").attr("id",id+"_status_text").attr("width",14).attr("height",14).attr("x",point.x-6).attr("y",point.y+4).attr("font-family","FontAwesome").attr("fill",getStatusColor(status)).style("background","white").text(function(d){return getStatusIcon(status)})}function drawExpandIcon(svg,x,y,r,angle,opts){var point=findPointOnCircumference(x,y,r,angle);svg.append("circle").attr("id",opts.id+"_expand_circle").attr("cx",point.x+2).attr("cy",point.y).attr("r",5).style("stroke","white").style("fill","white");svg.append("text").attr("id",opts.id+"_expand_text").attr("width",14).attr("height",14).attr("x",point.x-6).attr("y",point.y+4).attr("font-family","FontAwesome").attr("fill","#40B1F1").on("mousedown",function(event){if(event){event.stopPropagation()}if(opts.onClickFun){opts.onClickFun()}}).on("mouseover",function(){d3.select(this).style("cursor","pointer");d3.select(this).style("stroke",opts.stroke?opts.stroke:unSelectedColor)}).on("mouseout",function(){d3.select(this).style("stroke","")}).text("").append("svg:title").text("Load next level")}function drawCountIcon(svg,x,y,r,angle,count,id){var point=findPointOnCircumference(x,y,r,angle);var width;if(count.toString().length*10<20){width=15}else{width=count.toString().length*10}svg.append("rect").attr("id",id+"_count_rect").attr("x",point.x-4).attr("y",point.y-8).attr("width",width).attr("height",15).attr("rx",4).attr("ry",4).style("stroke","black").style("fill","black");svg.append("text").attr("id",id+"_count_text").attr("x",point.x).attr("y",point.y+3).attr("fill","white").style("background","black").style("font-size","12px").text(function(d){return count})}function connectNodes(svg,node1,node2,level,selected){if(node1.x===node2.x&&node1.y===node2.y)return;var diagonal=getConnectorPath(node1,node2,level);var path=svg.append("path").style("stroke",selected?selectedColor:unSelectedColor).attr("d",diagonal);var cls="link "+node1.id+" "+node2.id;if(node1.dep){var length=Math.sqrt(Math.pow(node1.x-node2.x,2)+Math.pow(node1.y-node2.y,2));var dashArrays=[["2","2"],["3","2"],["4","3"],["5","3"],["6","4"],["7","4"],["8","5"],["9","5"],["10","5"]];var lengthOfSeries=87;var multiplier=Math.ceil(length/lengthOfSeries);if(node1.dep=="child"){dashArrays.reverse()}var pattern="";
for(var i=0;i<dashArrays.length;i++){var x=dashArrays[i];for(var ii=0;ii<multiplier;ii++){for(var iii=0;iii<x.length;iii++){pattern+=x[iii]+","}}}path.style("stroke-dasharray",pattern.slice(0,-1));cls+=" dep "+node1.dep+node1.id;cls+=" "+node2.dep+node2.id}path.attr("class",cls)}function connectNodesByIds(svg,id1,id2,level){var x1,y1,r1,x2,y2,r2;try{x1=+d3.selectAll("circle#"+id1).attr("cx");y1=+d3.selectAll("circle#"+id1).attr("cy");r1=+d3.selectAll("circle#"+id1).attr("r");x2=+d3.selectAll("circle#"+id2).attr("cx");y2=+d3.selectAll("circle#"+id2).attr("cy");r2=+d3.selectAll("circle#"+id2).attr("r");connectNodes(svg,{x:x1,y:y1,r:r1,id:id1},{x:x2,y:y2,r:r2,id:id2},level)}catch(err){console.log(err)}}function getConnectorPath(node1,node2,level){var x1=node1.x;var x2=node2.x;var y1=node1.y;var y2=node2.y;var space=100-node1.r-node2.r;var endpoints=[{x:0,y:0},{x:0,y:0}];var gap=" ";if(x2>x1&&y2===y1){endpoints[0].x=node1.x;endpoints[0].y=node1.y-node1.r;endpoints[1].x=node2.x;endpoints[1].y=node2.y-node2.r;return"M"+node1.x+","+(node1.y-node1.r)+gap+"Q"+node1.x+","+(node1.y-2*node1.r+6)+gap+(node1.x+node1.r)+","+(node1.y-node1.r-2*(space/10))+gap+"L"+(node2.x-node2.r)+","+(node2.y-node2.r-2*(space/10))+gap+"Q"+node2.x+","+(node2.y-2*node2.r+6)+gap+node2.x+","+(node2.y-node2.r)}else if(x2>x1&&y2<y1){endpoints[0].x=node1.x;endpoints[0].y=node1.y-node1.r;endpoints[1].x=node2.x;endpoints[1].y=node2.y+node2.r;if(level===0){return"M"+node1.x+","+(node1.y-node1.r)+gap+"L"+node1.x+","+(node2.y+2*(space/10))+gap+"Q"+node1.x+","+(node2.y+4)+gap+(node1.x+node1.r/2)+","+node2.y+gap+"L"+(node2.x-node2.r)+","+node2.y}return"M"+endpoints[0].x+","+endpoints[0].y+gap+"L"+endpoints[0].x+","+(endpoints[0].y-6*(space/10))+gap+"Q"+endpoints[0].x+","+(endpoints[1].y+15)+gap+(endpoints[0].x+node1.r/2)+","+(endpoints[1].y+2*(space/10))+gap+"L"+(endpoints[1].x-node2.r/2)+","+(endpoints[1].y+2*(space/10))+gap+"Q"+endpoints[1].x+","+(endpoints[1].y+10)+gap+endpoints[1].x+","+endpoints[1].y}else if(x2===x1&&y2<y1){endpoints[0].x=node1.x;endpoints[0].y=node1.y-node1.r;endpoints[1].x=node2.x;endpoints[1].y=node2.y+node2.r;return"M"+endpoints[0].x+","+endpoints[0].y+gap+"L"+endpoints[1].x+","+endpoints[1].y}else if(x2<x1&&y2<y1){endpoints[0].x=node1.x;endpoints[0].y=node1.y-node1.r;endpoints[1].x=node2.x;endpoints[1].y=node2.y+node2.r;if(level===0){return"M"+node1.x+","+(node1.y-node1.r)+gap+"L"+node1.x+","+(node2.y+2*(space/10))+gap+"Q"+node1.x+","+(node2.y+4)+gap+(node1.x-node1.r/2)+","+node2.y+gap+"L"+(node2.x+node2.r)+","+node2.y}return"M"+endpoints[0].x+","+endpoints[0].y+gap+"L"+endpoints[0].x+","+(endpoints[0].y-6*(space/10))+gap+"Q"+endpoints[0].x+","+(endpoints[1].y+15)+gap+(endpoints[0].x-node1.r/2)+","+(endpoints[1].y+2*(space/10))+gap+"L"+(endpoints[1].x+node2.r/2)+","+(endpoints[1].y+2*(space/10))+gap+"Q"+endpoints[1].x+","+(endpoints[1].y+10)+gap+endpoints[1].x+","+endpoints[1].y}else if(x2<x1&&y2===y1){return getConnectorPath(node2,node1,level)}else if(x2<x1&&y2>y1){return getConnectorPath(node2,node1,level)}else if(x2===x1&&y2>y1){return getConnectorPath(node2,node1,level)}else if(x2>x1&&y2>y1){return getConnectorPath(node2,node1,level)}}function findPointOnCircumference(x,y,r,angle_in_degrees){var angle_in_radians=Math.PI/180*angle_in_degrees;return{x:x+r*Math.cos(angle_in_radians),y:y-r*Math.sin(angle_in_radians)}}function getIdForPattern(svg,image){return svg.ns+"_"+base64(image).replace(/=/g,"")}function getPatternUrl(patternId){if(isIE()&&isIE()<10){return"url(#"+patternId+")"}else{var hasBase=d3.select("head>base")[0][0];return hasBase?"url("+location.href+"#"+patternId+")":"url(#"+patternId+")"}}function isIE(){return document.documentMode}var statusIconMap={successful:"",failure:"",pending:"",ignored:"",aborted:"",unstable:"",_missing:""};var statusColorMap={successful:"#ADCD49",failure:"#F94842",pending:"#F9DD00",ignored:"#ADBCC4",aborted:"#ADBCC4",unstable:"#FB782F",_missing:"#FFFFFF"};var canonicalStatus={successful:"successful",success:"successful",close:"successful",closed:"successful",submitted:"successful",failure:"failure",failed:"failure",rejected:"failure",pending:"pending",open:"pending","new":"pending","in progress":"pending",ignored:"ignored",aborted:"aborted",discarded:"aborted",deleted:"aborted",unstable:"unstable"};function getStatusIcon(status){try{return statusIconMap[canonicalStatus[status.toLowerCase()]]}catch(e){return statusIconMap._missing}}function getStatusColor(status){try{return statusColorMap[canonicalStatus[status.toLowerCase()]]}catch(e){return statusColorMap._missing}}var canonicalTypeMap={WorkItem:"work_items",work_item:"work_items",WorkItemSummary:"work_items",commit:"commits",Commit:"commits",CommitSummary:"commits",Review:"reviews",review:"reviews",ReviewRequestSummary:"reviews",build:"builds",Build:"builds",BuildSummary:"builds",custom:"custom",XDS:"custom",CustomSummary:"custom"};function getCanonicalType(type){return canonicalTypeMap[type]||type}function getStatusFromObject(obj){if(obj.objectType){var statusClass=obj.statusClass;var isWorkItem=false;if(obj.teamForgeId){if(startsWith(obj.teamForgeId,"cmmt")){return undefined}if(startsWith(obj.teamForgeId,"artf")&&statusClass){isWorkItem=true}}if(obj.objectType==="WorkItemSummary"){isWorkItem=true}if(isWorkItem){if(obj.deleted){statusClass="deleted"}else{if(statusClass){statusClass=statusClass=="Close"?"successful":"open"}}}if(!statusClass||statusClass.length==0){return undefined}return statusClass}return undefined}function getStatusNameFromObject(obj){var result=null;if(obj.deleted){result="Deleted"}if(!result){if(startsWith(obj.teamForgeId,"artf")){result=obj.statusClass=="Close"?"Closed":"Open"}if(!result&&obj.status){result=obj.status}}return result?capitalizeWord(result):""}function getCustomNameFromFieldName(field){if(field){return capitalizeWord(field.replace(/_/g," "))}return""}function fetchLevelN(qs,scope,n){var queryParams=makeServiceParams(scope);queryParams.levelNum=n;qs.fetchNthLevelAssociations(queryParams)}function makeKeyForLevelN(qs,scope,n){var queryParams=makeServiceParams(scope);queryParams.levelNum=n;return qs.getKey(queryParams)}function makeServiceParams(scope){return{token:scope.token,remoteId:scope.remoteid,sourceType:scope.sourcetype,remoteSource:scope.remotesource,ctfUrl:scope.ctfurl,includeCtfAssociations:scope.includectfassociations=="true",readNextLevel:scope.readnextlevel=="true"}}function capitalizeWord(word){if(word===undefined)return"";if(word.length===0)return word;if(word.length===1)return word.toUpperCase();return word.substr(0,1).toUpperCase()+word.substr(1).toLowerCase()}function htmlDecode(text){var div=document.createElement("div");div.innerHTML=text;return"textContent"in div?div.textContent:div.innerText}function htmlEncode(str){return encodeEntities(str)}var SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g,ESCAPE_CSS_NOTATION_CHARACTERS_REGEXP=/(:|\.|\[|\]|,|=)/g;function escapeCSSNotationCharacters(id){return id.replace(ESCAPE_CSS_NOTATION_CHARACTERS_REGEXP,"\\$1")}function encodeEntities(value){return value?value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return"&#"+((hi-55296)*1024+(low-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function setVal(k,v){kvPair[k]=v}function getVal(k){return kvPair[k]}function setDateFormat(s){dateFormat=s}function setTimeFormat(s){timeFormat=s}function setTimeZone(s){timeZone=s}function getInternalDateString(d){var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(usingMoment){return moment(d).tz(timeZone).format(internalDateFormat)}else{var date=new Date(d);return month[date.getUTCMonth()]+" "+date.getUTCDate()+" "+date.getUTCFullYear()}}function getDateString(d){return usingMoment?moment(d).tz(timeZone).format(dateFormat):getInternalDateString(d)}function getTimeString(d){if(usingMoment){return moment(d).tz(timeZone).format(timeFormat)}else{var date=new Date(d);return date.getUTCHours()+":"+date.getUTCMinutes()+":"+date.getUTCSeconds()+" GMT"}}function moveElement(){this.parentNode.appendChild(this);var dragTarget=d3.select(this);var newLeft=d3.event.dx+this.offsetLeft,newTop=d3.event.dy+this.offsetTop;var boundingRect=this.parentNode.getBoundingClientRect();if(newLeft<0||newLeft>boundingRect.right-200||newTop<0||newTop>400)return;dragTarget.style({right:"auto",bottom:"auto",left:newLeft+"px",top:newTop+"px"})}function base64(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4)}return output}function isMaxLevelNodes(levelData){var max=100;if(kvPair.hasOwnProperty("maxLevelNodes")){max=kvPair.maxLevelNodes}return max>0&&levelData&&levelData.length>max}function getMassagedUrl(ctfUrl,url){if(!url||!ctfUrl||ctfUrl.length==0||startsWith(url,"http")){return url}var useCtfUrl=ctfUrl;var useUrl=url;if(endsWith(useCtfUrl,"/")&&startsWith(useUrl,"/")){useCtfUrl=useCtfUrl.slice(0,-1)}if(!endsWith(useCtfUrl,"/")&&!startsWith(useUrl,"/")){useCtfUrl=useCtfUrl+"/"}return useCtfUrl+useUrl}function startsWith(searchIn,searchFor){if(searchIn&&searchFor){return searchIn.lastIndexOf(searchFor,0)===0}return false}function endsWith(searchIn,searchFor){if(searchIn&&searchFor&&searchFor.length<=searchIn.length){return searchIn.indexOf(searchFor,searchIn.length-searchFor.length)!==-1}return false}})();(function(){"use strict";var mainModule=angular.module("tfTraceability");mainModule.directive("paginationComponent",function(){return{restrict:"AEC",scope:{onInit:"&",previousPageIcon:"@",nextPageIcon:"@"},replace:true,template:"<span>"+'  <div data-ng-show="paginationObject.getMaxPage() > 1"'+'       class="pagination pagination-medium table-pagination">'+"<ul>"+"<li ng-class=\"{'disabled': paginationObject.getSelectedPage() === 1}\">"+"<a ng-class= \"{'pagination-link': paginationObject.getSelectedPage() != 1}\" "+'   ng-click="paginationObject.isBlockPagination() ? '+"    paginationObject.goToPage(paginationObject.getSelectedPage() - 1) : "+'    paginationObject.goToPage(1)">'+'<img ng-if="previousPageIcon" '+'ng-src="{{previousPageIcon}}" width="6" alt="Previous" '+'height="10" border= "0">'+'  <span ng-if="!previousPageIcon">&lsaquo;</span></a>'+"</li>"+'<li data-ng-show="paginationObject.getShowPageNumbers()"'+'    data-ng-repeat= "paginationIndex in paginationObject.getPaginationIndexes()"'+"    ng-class= \"{'active': paginationObject.getSelectedPage() === paginationIndex}\">"+' <a class="pagination-link" ng-click= "paginationObject.goToPage(paginationIndex)"'+"    data-ng-hide= \"paginationIndex === 'PREVIOUS' || paginationIndex === 'NEXT'\">"+"    {{paginationIndex}}</a>"+" <div data-ng-show= \"paginationIndex==='PREVIOUS' || paginationIndex==='NEXT'\">...</div>"+"</li>"+"<li ng-class= \"{'disabled': paginationObject.getSelectedPage() === paginationObject.getMaxPage()}\">"+"<a ng-class= \"{'pagination-link': paginationObject.getSelectedPage() != paginationObject.getMaxPage()}\""+'   ng-click= "paginationObject.isBlockPagination() ? paginationObject.goToPage(paginationObject.getSelectedPage() + 1) : paginationObject.goToPage(paginationObject.getMaxPage())">'+'  <img ng-if="nextPageIcon" ng-src="{{nextPageIcon}}" width="6" alt="Previous" '+'height="10" border="0">'+'  <span ng-if="!nextPageIcon">&rsaquo;</span></a>'+"</li>"+"</ul>"+"</div>"+"</span>",controller:["$scope","paginationObjectService",function($scope,paginationObjectService){var pagination=paginationObjectService.createPaginationObject();$scope.paginationObject=pagination;$scope.onInit({pagination:pagination})}]}});mainModule.service("paginationObjectService",function(){var pageSize=15,blockSize=5,self=this;this.defaultPageSize=function(){return pageSize};this.defaultBlockSize=function(){return blockSize};function PaginationObject(callback){this.$$pagination=[];this.$$callBackFunction=callback||angular.noop;this.$$selectedPage=1;this.$$maxPageNumber=1;this.$$pageSize=self.defaultPageSize();this.$$showPageNumbers=true;this.$$elementCount=0;this.$$blockPagination=false;this.$$blockSize=self.defaultBlockSize()}PaginationObject.prototype={createPaginationIndexes:function(){var step=-1,i;var blockInit=1;this.$$pagination=[];if(this.$$blockPagination){if(this.$$selectedPage>0){blockInit=(Math.ceil(this.$$selectedPage/this.$$blockSize)-1)*this.$$blockSize+1}for(i=blockInit;i<blockInit+this.$$blockSize&&i<=this.$$maxPageNumber;i=i+1){this.$$pagination.push(i)}}else{while(this.$$selectedPage+step>0){for(i=1;i<6&&this.$$selectedPage+step*i>0;i=i+1){this.$$pagination.unshift(this.$$selectedPage+step*i)}if(step==-1&&this.$$selectedPage+step*i>0){this.$$pagination.unshift("PREVIOUS")}step*=10}if(this.$$pageSize>0){this.$$pagination.push(this.$$selectedPage)}step=1;while(this.$$selectedPage+step<=this.$$maxPageNumber){for(i=1;i<6&&this.$$selectedPage+step*i<=this.$$maxPageNumber;i=i+1){this.$$pagination.push(this.$$selectedPage+step*i)}if(step==1&&this.$$selectedPage+step*(i-1)<this.$$maxPageNumber){this.$$pagination.push("NEXT")}step*=10}}},getSelectedPage:function(){return this.$$selectedPage},getIsFirstPage:function(){return this.$$selectedPage===1},getIsLastPage:function(){return this.$$maxPageNumber===this.$$selectedPage},getPaginationIndexes:function(){return angular.copy(this.$$pagination)},getMaxPage:function(){return this.$$maxPageNumber},setElementCount:function(elementCount){this.$$elementCount=elementCount;if(this.$$pageSize>0){this.$$maxPageNumber=elementCount?Math.ceil(elementCount/this.$$pageSize):1}else{this.$$maxPageNumber=1}if(this.$$selectedPage>this.$$maxPageNumber){this.$$selectedPage=this.$$maxPageNumber}this.createPaginationIndexes()},getOffset:function(){return this.$$pageSize>0?(this.$$selectedPage-1)*this.$$pageSize:0},setCallBackFunction:function(callback){this.$$callBackFunction=callback},goToPage:function(page){this.$$selectedPage=page>this.$$maxPageNumber?this.$$maxPageNumber:page;this.$$callBackFunction(page,this.$$pageSize,this.$$blockSize);this.createPaginationIndexes()},setPageSize:function(size,elementCount){this.$$pageSize=size;this.setElementCount(elementCount);this.goToPage(1)},getPageSize:function(){return this.$$pageSize},getBlockSize:function(){return this.$$blockSize},getPaginationSize:function(){return this.$$pagination.length},isBlockPagination:function(){return this.$$blockPagination},setBlockPagination:function(blockPagination){this.$$blockPagination=blockPagination},setBlockSize:function(blockSize){this.$$blockSize=blockSize},getShowPageNumbers:function(){return this.$$showPageNumbers},setShowPageNumbers:function(showPageNumbers){this.$$showPageNumbers=showPageNumbers}};this.createPaginationObject=function(callbackFn){return new PaginationObject(callbackFn)}});mainModule.directive("pageSizeComponent",["$cookieStore",function($cookieStore){return{restrict:"AEC",scope:{onPageSizeChange:"&",pageSizeMeta:"="},link:function(scope,elm,attrs){var cookieName=scope.$parent.$eval(attrs.cookieName),cookieValue=$cookieStore.get(cookieName);if(cookieValue){scope.pageSize=parseInt(cookieValue,10)}if(!scope.pageSize){scope.pageSize=scope.pageSizeMeta[0].value;$cookieStore.put(cookieName,scope.pageSize)}scope.pageSizeChange=function(newPageSize){$cookieStore.put(cookieName,newPageSize);scope.pageSize=newPageSize;scope.onPageSizeChange({size:newPageSize})};scope.onPageSizeChange({size:scope.pageSize})},replace:true,template:'<span class="page-size nav">'+'<span data-uib-dropdown class="pull-right">'+'    <a class="btn-link" data-uib-dropdown-toggle>'+'      <i class="fa fa-align-justify"></i>'+"    </a>"+'    <ul class="uib-dropdown-menu">'+'      <li data-ng-repeat="item in pageSizeMeta" data-ng-switch="item.type">'+'        <div data-ng-switch-when="divider" class="divider"></div>'+'        <a data-ng-switch-default data-ng-click="pageSizeChange(item.value)" class="btn-link">'+"          <span data-ng-class=\"{'widgets-page-size-hide-child': pageSize !== item.value, 'widgets-page-size-selected': pageSize === item.value}\">"+'            <i class="fa fa-check"></i>'+"          </span>"+"          <span>{{item.label}}</span>"+"        </a>"+"      </li>"+"    </ul>"+"  </span>"+"</span>"}}])})();(function(){angular.module("tfTraceability").directive("tfTraceabilityExploration",["tfUtilService","$timeout",tfTraceabilityExplorationImplementation]);function tfTraceabilityExplorationImplementation(tfUtil,timeout){return{link:linkFunc,restrict:"E",template:'<div id="tf-traceability-wrapper">'+'<div id="associations-trace-dependency-toggle-wrapper" class="col-md-12 associations-trace-dependency-toggle">'+'  <div class="associations-trace">'+'    <span>{{getLabel("dependencies")}}</span>'+'    <a ng-click="setIncludeDependencies(!includedependencies)">'+'      <i ng-if="!includedependencies" class="fa fa-toggle-off fa-lg"></i>'+'      <i ng-if="includedependencies" class="fa fa-toggle-on fa-lg"></i>'+"    </a>"+"  </div>"+"</div>"+'<div id="tf-traceability-main-wrapper" class="col-md-12">'+'<div class="tf-associations-explore-chevrons">'+'<div class="tf-left-chevron"><i class="fa fa-chevron-left"></i></div>'+'<div class="tf-right-chevron"><i class="fa fa-chevron-right"></i></div>'+"</div>"+'<svg id="tf-explore-svg">'+'<g class="axis">'+"<tf-traceability-timeaxis></tf-traceability-timeaxis>"+"</g>"+'<g class="levels" id="tf-explore-levels">'+"<defs></defs>"+'<tf-traceability-level activity="explore" level="0" '+'includectfassociations="{{includectfassociations}}">'+"</tf-traceability-level>"+'<tf-traceability-level activity="explore" level="1" '+'includectfassociations="{{includectfassociations}}" readnextlevel="true">'+"</tf-traceability-level>"+'<tf-traceability-level activity="explore" level="2" '+'expandable="true" '+'includectfassociations="{{includectfassociations}}" readnextlevel="false">'+"</tf-traceability-level>"+"</g>"+"</svg>"+'<div id="max-nodes-exceeded"></div>'+"</div>"+'<div id="tf-traceability-sidebar-wrapper" class="pull-right col-md-4">'+'<div id="tf-associated-node-details"></div>'+"</div>"+"</div>",scope:{token:"@",remotesource:"@",sourcetype:"@",remoteid:"@",ctfurl:"@",dateformat:"@",disableorc:"@",timeformat:"@",timezone:"@",svgwidth:"@",svgheight:"@",includectfassociations:"@"},controller:["$scope","tfI18nService","tfLocalStorageService","tfQueryService",function($scope,i18n,tfStorage,tfQueryService){$scope.includedependencies=tfStorage.getData("include-dependencies");$scope.getLabel=function(key){return i18n.translate(key)};$scope.setIncludeDependencies=function(val){tfStorage.setData("include-dependencies",val);$scope.includedependencies=val};$scope.$watch("includedependencies",function(newValue,oldValue){if(newValue!=oldValue){$scope.$broadcast("include-dependencies-change",newValue)}})}]};function linkFunc(scope,element,attr){timeout(function(){var d3svg=d3.select("svg#tf-explore-svg");var d3svggroup=d3.select("g#tf-explore-levels");tfUtil.configureSizeInSVG(d3svg,scope.svgwidth,scope.svgheight);tfUtil.setVal("svgWidth",d3.select("svg#tf-explore-svg")[0][0].clientWidth);tfUtil.setVal("ctfUrl",scope.ctfurl);tfUtil.configureDragForNodes(d3svg,d3svggroup);if(scope.dateformat)tfUtil.setDateFormat(scope.dateformat);if(scope.timeformat)tfUtil.setTimeFormat(scope.timeformat);if(scope.timezone)tfUtil.setTimeZone(scope.timezone)},0)}}})();(function(){angular.module("tfTraceability").directive("tfTraceabilityLevel",["$q","tfI18nService","tfQueryService","tfUtilService","$compile","$timeout","$location",tfTraceabilityLevelImplementation]);var levelListeners=[],alreadyListened={},levelQueryParams={};function tfTraceabilityLevelImplementation($q,i18n,tfQueryService,tfUtil,$compile,timeout,$location){var redrawNodeId=null;return{templateNamespace:"svg",type:"svg",link:linkFunc,restrict:"E",template:'<g class="nodes"></g>',scope:true,replace:true};function makeQueryParams(scope,level){return{ctfUrl:scope.ctfurl,token:scope.token,remoteId:scope.remoteid,sourceType:scope.sourcetype,remoteSource:scope.remotesource,includeCtfAssociations:scope.includectfassociations=="true",readNextLevel:scope.readnextlevel=="true",levelNum:level}}function linkFunc(scope,element,attrs){scope.includectfassociations=attrs.includectfassociations;scope.readnextlevel=attrs.readnextlevel;var level=+attrs.level;var queryParams=makeQueryParams(scope,level);var prevLevel=tfQueryService.getKey(queryParams,-1);var nthLevel=tfQueryService.getKey(queryParams);levelQueryParams[nthLevel]=queryParams;if(attrs.expandable==="true"){var dependencyToggleTimeout=null;scope.$on("$destroy",function(event){if(dependencyToggleTimeout){timeout.cancel(dependencyToggleTimeout)}});scope.$on("include-dependencies-change",function(event,newValue){if(!newValue){var restData=tfQueryService.getRestResponse();if(restData&&!restData.hasDependencyAssociations()){return}}dependencyToggleTimeout=timeout(function(){if(scope.$parent.showDetailsPopup){closeSidebar(scope)}scope.maxNodesExceeded=false;d3.select("#max-nodes-exceeded").classed({alert:false,"alert-info":false}).text("");unregisterListeners();tfQueryService.clearCache();var parent=element.parent();var parentScope=scope.$parent;var includeCtfAssoc=' includectfassociations="'+(scope.includectfassociations==="true")+'"';scope.$destroy();parent.find("g").remove();var refreshLevels=$compile('<tf-traceability-level activity="explore" level="0"'+includeCtfAssoc+"></tf-traceability-level>"+'<tf-traceability-level activity="explore" level="1" readnextnevel="false"'+includeCtfAssoc+"></tf-traceability-level>"+'<tf-traceability-level activity="explore" level="2" readnextlevel="false" '+'expandable="true"'+includeCtfAssoc+"></tf-traceability-level>")(parentScope);tfUtil.setVal("maxLevel",2);parent.append(refreshLevels)},5)})}var offFun;offFun=scope.$on(prevLevel,function(event,dataAvailable){var keyToListen="prevLevel"+attrs.activity+prevLevel;if(dataAvailable&&!alreadyListened[keyToListen]){var restData=tfQueryService.getRestResponse();var prevLevelData=null;if(restData){prevLevelData=restData.getLevelIds(level-1)}if(tfUtil.isMaxLevelNodes(prevLevelData)){scope.maxNodesExceeded=true}else{scope.maxNodesExceeded=false;tfQueryService.fetchNthLevelAssociations(queryParams)}}});levelListeners.push(offFun);offFun=scope.$on(nthLevel,function(event,dataAvailable){var keyToListen="nthLevel"+attrs.activity+nthLevel;if(!nthLevel||alreadyListened[keyToListen])return;element.children().remove();var rawsvgelement=element[0];var d3svg=d3.select(rawsvgelement);d3svg.ns=attrs.activity;if(d3svg.ns==="summary"){drawSummaryVisual(+attrs.level,d3svg,scope)}else{var currentLevelKey=nthLevel;var keyLevel=parseInt(currentLevelKey);var restData=tfQueryService.getRestResponse();var isExpandableLevel=attrs.expandable==="true";var canDrawTraceVisual=isExpandableLevel;if(!canDrawTraceVisual){var currentLevelData=restData?restData.getLevelObjects(keyLevel):null;canDrawTraceVisual=currentLevelData&&tfUtil.isMaxLevelNodes(currentLevelData)}if(canDrawTraceVisual){for(var level=0;level<=keyLevel;level++){var levelData=restData.getLevelObjects(level);drawTraceVisual(scope,level,levelData,d3svg,keyLevel===level&&isExpandableLevel,element)}}d3.select("svg#tf-explore-svg").style("height",250+keyLevel*100+"px")}});levelListeners.push(offFun);tfUtil.setVal("disableOrc",scope.disableorc=="true");if(level>0){tfQueryService.fetchNthLevelAssociations(levelQueryParams[prevLevel])}}function closeSidebar(scope){var useScope=null;if(scope&&scope.$parent){useScope=scope.$parent}if(!useScope){var element=document.getElementById("tf-associated-node-details");if(element){var ascope=angular.element(element).scope();if(ascope&&ascope.showDetailsPopupNodeId){useScope=ascope}}}if(useScope){useScope.showDetailsPopup=false;useScope.showDetailsPopupNodeId=null;redrawNodeId=null;d3.select("div#tf-associated-node-details").style("display","none");d3.select("#tf-traceability-main-wrapper").classed("col-md-12",true).classed("col-md-8",false);d3.select("#tf-traceability-sidebar-wrapper").style("display","none")}}function drawTraceVisual(scope,level,currentLevelData,d3svg,isExpandable,element){if(tfUtil.isMaxLevelNodes(currentLevelData)){scope.maxNodesExceeded=true}var restData=tfQueryService.getRestResponse();var showDetailFun=function(nodeId){if(scope.$parent.showDetailsPopup&&scope.$parent.showDetailsPopupNodeId==nodeId){closeSidebar(scope);tfUtil.showChevrons(d3svg);return}var objectSummary=getObjectSummary(nodeId);var displayData=getDisplayFields(objectSummary);var div=d3.select("div#tf-associated-node-details");var initialViewPort=d3.select("svg#tf-explore-svg")[0][0];var initialViewPortWidth=initialViewPort.getBoundingClientRect().width;var initialRightSideOfViewPort=initialViewPort.getBoundingClientRect().right;div.selectAll("*").remove();var avatarImg="";var userDetail="";var timestampSpan="";var wideClass="";var detailsDiv="";displayData.fields.forEach(function(d){if((d[0]=="By"||d[0]=="Initiated By")&&d[1]){var id=d[1].trim().toLowerCase();var md5hash=md5(id);var letter=id.length===0?"_":id.slice(0,1);letter=letter.match(/^[a-z0-9]$/i)?letter.toUpperCase():"_";avatarImg='<img class="avatar avatar32 float-left" src="'+tfUtil.getMassagedUrl(scope.ctfurl,"/avatar/64/")+letter+"/"+md5hash+'">';userDetail=d[1];wideClass="tf-association-source-icon-wide"}else if(d[0]=="At"&&d[1]){timestampSpan=d[1]}else if(d[0]&&d[1]){var fieldVal="";if(d[0]=="Status"){fieldVal='<span class="fa fa-fw tf-association-id-icon" style="color:'+displayData.statusColor+';">'+displayData.statusIcon+"</span>"+(tfUtil.htmlEncode(d[1])||"").replace(/\n/g,"<br />")}else{fieldVal=(tfUtil.htmlEncode(d[1])||"").replace(/\n/g,"<br />")}detailsDiv+='<div class="tf-traceability-sidebar-wrapper-details-field">'+'  <span class="tf-traceability-sidebar-wrapper-details-field-name">'+d[0]+": "+"</span>"+"  <span>"+fieldVal+"</span>"+"</div>"}});var iconAndId='<td class="tf-association-id-text">'+displayData.id+"</td>";if(displayData.sourceIcon){iconAndId='<td class="tf-association-source-icon '+wideClass+'">'+'<img src="'+displayData.sourceIcon+'"></img></td>'+iconAndId}var idAndSrc='  <tr id="tf-association-inner-detail-header">'+'    <td colspan="2">'+'      <table class="tf-association-inner-detail-table">'+'        <tr class="tf-association-id">'+iconAndId+'          <td class="tf-explore-close"><a xlink:href="#"><i id="tf-traceability-sidebar-close-btn" class="fa fa-close fa-lg"></i></a></td>'+"        </tr>"+'        <tr class="tf-association-source">'+"          <td></td>"+'          <td class="tf-association-source-text">'+displayData.sourceName+"</td>"+"        </tr>"+'        <tr class="tf-association-source">'+"          <td>"+avatarImg+"</td>"+"          <td>"+'            <div class="tf-association-detail-user">'+userDetail+"</div>"+'            <div class="tf-association-detail-timestamp">'+timestampSpan+"</div>"+"          </td>"+"        </tr>"+"      </table>"+"    </td>"+"  </tr>";var sidebarDetails="  <tr>"+'    <td class="tf-traceability-sidebar-wrapper-td-details" colspan="2">'+'      <div class="tf-traceability-sidebar-wrapper-details">'+detailsDiv+"      </div>"+"    </td>"+"  </tr>";var sidebarActions="";var canSetAsTarget=objectSummary.level!==0;var canLinkTo=displayData.linkLabel&&displayData.link&&true;if(canLinkTo&&objectSummary.teamForgeId){canLinkTo=$location.url().indexOf(objectSummary.teamForgeId)<0}if(canLinkTo&&objectSummary.remoteId){var gitClue="treeId="+objectSummary.remoteId;var svnClue="/commits/"+objectSummary.remoteId;canLinkTo=$location.url().indexOf(gitClue)<0&&$location.url().indexOf(svnClue)<0}if(!objectSummary.deleted){sidebarActions="  <tr>"+'    <td class="tf-traceability-sidebar-wrapper-td-actions">'+(canSetAsTarget?'<a id="tf-traceability-sidebar-wrapper-set-target">'+i18n.translate("setAsTarget")+"</a>":'<span id="tf-traceability-sidebar-wrapper-set-target">'+i18n.translate("setAsTarget")+"</span>")+"    </td>"+'    <td class="tf-traceability-sidebar-wrapper-td-actions">'+(canLinkTo?'<a id="tf-traceability-sidebar-wrapper-link-to">'+displayData.linkLabel+"</a>":'<span id="tf-traceability-sidebar-wrapper-link-to">'+displayData.linkLabel+"</span>")+"    </td>"+"  </tr>"}var tableTemplate='<table class="tf-traceability-sidebar-wrapper-table">'+idAndSrc+sidebarDetails+sidebarActions+"</table>";div.html(tableTemplate);if(!objectSummary.deleted){if(canSetAsTarget){d3.select("#tf-traceability-sidebar-wrapper-set-target").on("click",function(){scope.maxNodesExceeded=false;d3.select("#max-nodes-exceeded").classed({alert:false,"alert-info":false}).text("");scope.$apply(function(){scope.$parent.sourcetype="teamforge";scope.$parent.remotesource="object:id";scope.$parent.remoteid=objectSummary.id;unregisterListeners();tfQueryService.clearCache();var includeCtfAssoc=' includectfassociations="'+(scope.includectfassociations==="true")+'"';var parent=element.parent();var parentScope=scope.$parent;scope.$destroy();parent.find("g").remove();var refreshLevels=$compile('<tf-traceability-level activity="explore" level="0"'+includeCtfAssoc+"></tf-traceability-level>"+'<tf-traceability-level activity="explore" level="1" readnextnevel="false"'+includeCtfAssoc+"></tf-traceability-level>"+'<tf-traceability-level activity="explore" level="2" readnextlevel="false" '+'expandable="true"'+includeCtfAssoc+"></tf-traceability-level>")(parentScope);tfUtil.setVal("maxLevel",2);parent.append(refreshLevels)})})}if(canLinkTo){d3.select("#tf-traceability-sidebar-wrapper-link-to").on("click",function(){window.location=displayData.link||""})}}d3.select("#tf-traceability-sidebar-close-btn").on("mouseover",function(){this.style.textDecoration="none"}).on("click",function(){closeSidebar(scope)});div.style("display","block");scope.$parent.showDetailsPopup=true;scope.$parent.showDetailsPopupNodeId=nodeId;div.call(d3.behavior.drag().on("drag",tfUtil.moveElement));var mainWrapper=d3.select("#tf-traceability-main-wrapper");mainWrapper.classed("col-md-12",false).classed("col-md-8",true);d3.select("#tf-traceability-sidebar-wrapper").style("display","block");var mainWrapperHeight=mainWrapper[0][0].getBoundingClientRect().height;var actionHeight=!objectSummary.deleted?d3.select(".tf-traceability-sidebar-wrapper-td-actions")[0][0].getBoundingClientRect().height:0;var headerHeight=d3.select("#tf-association-inner-detail-header")[0][0].getBoundingClientRect().height;var adjustedHeight=mainWrapperHeight-actionHeight-headerHeight;var sideBarWrapperDetails=d3.select(".tf-traceability-sidebar-wrapper-details");sideBarWrapperDetails.style("height",adjustedHeight+"px");if(sideBarWrapperDetails.property("scrollHeight")>sideBarWrapperDetails.property("clientHeight")){sideBarWrapperDetails.style("padding-right","15px");d3.select(".tf-traceability-sidebar-wrapper-td-details").style("padding-right","0px")}var viewPort=d3.select("svg#tf-explore-svg")[0][0];var rightSideOfViewPort=viewPort.getBoundingClientRect().right;var escapedNodeId=tfUtil.escapeCSSNotationCharacters(nodeId);var rightSideOfSelectedElement=d3.select("g#"+escapedNodeId+"_group")[0][0].getBoundingClientRect().right;if(rightSideOfSelectedElement>rightSideOfViewPort){var viewPortWidth=viewPort.getBoundingClientRect().width;var traceGraphRect=d3.select("g#tf-explore-levels")[0][0].getBoundingClientRect();var traceGraphWidth=traceGraphRect.width;var newXTranslate;if(traceGraphWidth<viewPortWidth){var initialXTranslate=d3.transform(d3.selectAll("g#tf-explore-levels").attr("transform")).translate[0];var traceGraphRight=traceGraphRect.right;
var viewPortRight=viewPort.getBoundingClientRect().right;newXTranslate=initialXTranslate-(traceGraphRight-viewPortRight)-(viewPortWidth-traceGraphWidth)/2}else{var bufferWidth=0;if(initialRightSideOfViewPort<rightSideOfSelectedElement){bufferWidth=d3.select("g#"+escapedNodeId+"_group")[0][0].getBoundingClientRect().width}var initalReducedXTranslate=d3.transform(d3.select("g#tf-explore-levels").attr("transform")).translate[0];newXTranslate=initalReducedXTranslate-bufferWidth-(1-viewPortWidth/initialViewPortWidth)*initialViewPortWidth}d3.selectAll("g#tf-explore-levels").attr("transform","translate("+newXTranslate+", 0)");d3.selectAll("g#tf-explore-dates").attr("transform","translate("+newXTranslate+", 0)")}tfUtil.showChevrons(d3svg)};var onClickFun=function(){var args=makeQueryParams(scope,level+1);args.readNextLevel=false;var cachePromise=tfQueryService.cache(args);cachePromise.then(function(response){timeout(function(){scope.$apply(function(){var includeCtfAssoc=' includectfassociations="'+(scope.includectfassociations==="true")+'"';var parent=element.parent();var parentScope=scope.$parent;var refreshLevels=$compile('<tf-traceability-level activity="explore" readnextlevel="false" level="'+level+'"'+includeCtfAssoc+"></tf-traceability-level>"+'<tf-traceability-level activity="explore" readnextlevel="false" level="'+(level+1)+'" expandable="true"'+includeCtfAssoc+"></tf-traceability-level>")(parentScope);scope.$destroy();element.remove();tfUtil.setVal("maxLevel",level+1);parent.append(refreshLevels)})})})};var currentNodeData,toolTip;currentLevelData.forEach(function(currentNodeData){if(currentNodeData){var type=currentNodeData.objectType;var nodeId=d3svg.ns+"_orc_"+currentNodeData.id;if(nodeId==scope.$parent.showDetailsPopupNodeId){redrawNodeId=nodeId}var objectSummary=getObjectSummary(nodeId);var displayData=getDisplayFields(objectSummary);toolTip=(currentNodeData.objectTypeSourceName||getTooltipForType(currentNodeData))+"\n"+i18n.translate("id")+": "+(currentNodeData.remoteId||currentNodeData.teamForgeId)+"\n"+i18n.translate("at")+": "+currentNodeData.__display_date+" "+currentNodeData.__display_time;displayData.fields.forEach(function(d){if(d[0]!="At"&&d[1]){toolTip+="\n"+d[0]+": "+d[1]}});if(toolTip.length>1024){toolTip=toolTip.substr(0,1021)+"..."}tfUtil.drawNode(d3svg,currentNodeData.cx,currentNodeData.cy,20,{id:nodeId,level:level,status:tfUtil.getStatusFromObject(currentNodeData),toolTip:toolTip,image:currentNodeData.__icon_url,showDetailFun:showDetailFun,selected:nodeId==redrawNodeId,onClickFun:isExpandable&&!scope.maxNodesExceeded?onClickFun:undefined})}});if(level===0)return;var undrawnAssociationsCount;var previousLevelObjects=restData.getLevelObjects(level-1);currentLevelData.forEach(function(currentNodeData){if(currentNodeData){var associations=restData.getAssociatedObjects(currentNodeData.id,null);undrawnAssociationsCount=currentNodeData.nextDependencies?currentNodeData.nextDependencies:0;if(associations.length==0){if(previousLevelObjects){previousLevelObjects.forEach(function(previousLevelObj){var node_to_be_connected=previousLevelObj;if(node_to_be_connected!==undefined){var isAssociated=false;var dep1=null,dep2=null;if(restData.isAssociated(node_to_be_connected.id,currentNodeData.id,"parentAssociations")){dep1="parent";dep2="child";isAssociated=true}else if(restData.isAssociated(node_to_be_connected.id,currentNodeData.id,"childAssociations")){dep1="child";dep2="parent";isAssociated=true}else if(restData.isAssociated(node_to_be_connected.id,currentNodeData.id,"genericAssociations")){isAssociated=true}if(isAssociated){tfUtil.connectNodes(d3svg,{x:currentNodeData.cx,y:currentNodeData.cy,r:20,id:"explore_orc_"+currentNodeData.id,dep:dep1},{x:node_to_be_connected.cx,y:node_to_be_connected.cy,r:20,id:"explore_orc_"+node_to_be_connected.id,dep:dep2},level-1,"explore_orc_"+currentNodeData.id==redrawNodeId||"explore_orc_"+node_to_be_connected.id==redrawNodeId)}}})}}else{associations.forEach(function(association){var node_to_be_connected=association;if(node_to_be_connected!==undefined){if(node_to_be_connected.level===level-1||node_to_be_connected.level===level){var dep1=null,dep2=null;if(restData.isAssociated(currentNodeData.id,node_to_be_connected.id,"parentAssociations")){dep1="child";dep2="parent"}else if(restData.isAssociated(currentNodeData.id,node_to_be_connected.id,"childAssociations")){dep1="parent";dep2="child"}tfUtil.connectNodes(d3svg,{x:currentNodeData.cx,y:currentNodeData.cy,r:20,id:"explore_orc_"+currentNodeData.id,dep:dep1},{x:node_to_be_connected.cx,y:node_to_be_connected.cy,r:20,id:"explore_orc_"+node_to_be_connected.id,dep:dep2},level-1,"explore_orc_"+currentNodeData.id==redrawNodeId||"explore_orc_"+node_to_be_connected.id==redrawNodeId)}else{undrawnAssociationsCount++}}else{undrawnAssociationsCount++}})}}});d3.selectAll("g#tf-explore-levels").attr("transform","translate(0, 0)");d3.selectAll("g#tf-explore-dates").attr("transform","translate(0, 0)");tfUtil.showChevrons(d3svg);if(scope.maxNodesExceeded){d3.select("#max-nodes-exceeded").classed("alert alert-info",true).text(i18n.translate("limitExceeded"))}else{d3.select("#max-nodes-exceeded").classed({alert:false,"alert-info":false}).text("")}if(redrawNodeId){var viewPort=d3.select("svg#tf-explore-svg")[0][0];var rightSideOfViewPort=viewPort.getBoundingClientRect().right;var escapedRedrawNodeId=tfUtil.escapeCSSNotationCharacters(redrawNodeId);var selectedElement=d3.select("g#"+escapedRedrawNodeId+"_group")[0][0];if(selectedElement){var rightSideOfSelectedElement=selectedElement.getBoundingClientRect().right;var leftSideOfViewPort=viewPort.getBoundingClientRect().left;var leftSideOfSelectedElement=selectedElement.getBoundingClientRect().left;if(rightSideOfSelectedElement>rightSideOfViewPort||leftSideOfSelectedElement<leftSideOfViewPort){var viewPortWidth=viewPort.getBoundingClientRect().width;var traceGraphWidth=d3.select("g#tf-explore-levels")[0][0].getBoundingClientRect().width;var newXTranslate;if(traceGraphWidth<viewPortWidth){newXTranslate=traceGraphWidth/2}else{var bufferWidth=selectedElement.getBoundingClientRect().width;if(rightSideOfSelectedElement>rightSideOfViewPort){newXTranslate=rightSideOfViewPort-rightSideOfSelectedElement-bufferWidth}else{newXTranslate=leftSideOfViewPort-leftSideOfSelectedElement+bufferWidth}}d3.selectAll("g#tf-explore-levels").attr("transform","translate("+newXTranslate+", 0)");d3.selectAll("g#tf-explore-dates").attr("transform","translate("+newXTranslate+", 0)")}}}}function drawSummaryVisual(level,d3svg,scope){var targetX=80,targetY=25,targetId,currentNodeData;var zeroLevelId=null;var restData=tfQueryService.getRestResponse();if(restData){var zeroLevelIds=restData.getLevelIds(0);if(zeroLevelIds&&zeroLevelIds.length>0){zeroLevelId=zeroLevelIds[0];if(level==0){var zeroLevelObjSummary=restData.objectSummaries[zeroLevelId];targetId=d3svg.ns+"_orc_"+(zeroLevelObjSummary?zeroLevelObjSummary.id:zeroLevelId);tfUtil.drawNode(d3svg,targetX,targetY,20,{id:targetId,status:zeroLevelObjSummary?tfUtil.getStatusFromObject(zeroLevelObjSummary):"",toolTip:getSummaryVisualTooltipForType(zeroLevelObjSummary,true),image:zeroLevelObjSummary?zeroLevelObjSummary.__icon_url:"",onClickIcon:scope.$parent.refreshAssocTable});return}var x1=80,y1=70;var counts={},icons={},toolTips={},nodeIds={},nodeGroups={},seq=0;var associatedToObjects=zeroLevelId?restData.getAssociatedObjects(zeroLevelId,"genericAssociations"):[];var isAssociations=associatedToObjects&&associatedToObjects.length>0;if(isAssociations){associatedToObjects.forEach(function(associatedToObject){if(associatedToObject){var objectType=associatedToObject.objectType;var iconUrl=associatedToObject.__icon_url;var sourceNameOrType=iconUrl?associatedToObject.objectTypeSourceName:objectType;var nodeKey=sourceNameOrType||objectType;if(objectType=="CustomSummary"&&iconUrl){nodeKey+=iconUrl}icons[nodeKey]=iconUrl;var infoCount=restData.getAssociationCount(zeroLevelId,associatedToObject.id,"genericAssociations");counts[nodeKey]=counts.hasOwnProperty(nodeKey)?counts[nodeKey]+infoCount:infoCount;var toolTip=getSummaryVisualTooltipForType(associatedToObject,counts[nodeKey]==1);toolTips[nodeKey]=toolTip;seq++;nodeIds[nodeKey]=d3svg.ns+"_orc_"+seq;if(!nodeGroups.hasOwnProperty(nodeKey)){nodeGroups[nodeKey]={}}nodeGroups[nodeKey][associatedToObject.id]=associatedToObject.id}})}else{counts.none=0;icons.none=undefined;toolTips.none=i18n.translate("noAssociations");nodeIds.none=d3svg.ns+"_orc_none"}for(var key in counts){x1=x1+70;tfUtil.drawNode(d3svg,x1,y1,20,{id:nodeIds[key],group:nodeGroups[key],toolTip:toolTips[key],count:counts[key],image:key!=="none"?icons[key]:undefined,onClickIcon:scope.$parent.refreshAssocTable});tfUtil.connectNodes(d3svg,{x:x1,y:y1,r:20,id:nodeIds[key]},{x:targetX,y:targetY,r:20,id:"summary_orc_"+targetId},0)}}}}function getSummaryVisualTooltipForType(obj,showId){var tt="";if(obj){var tt=getTooltipForType(obj);if(showId){tt+="\n"+i18n.translate("id")+": "+(obj.remoteId||obj.teamForgeId)}}return tt}function getTooltipForType(obj){if(!obj){return""}if(typeof obj.objectTypeSourceName!=="undefined"){if(obj.objectTypeSourceName){return obj.objectTypeSourceName}}var type=null;if(typeof obj.objectType!=="undefined"){type=obj.objectType}if(!type){return obj}return i18n.translate(type)||type}function getObjectSummary(nodeId){var id=nodeId.replace("explore_orc_","");var restData=tfQueryService.getRestResponse();var objectSummary=null;var tfId=id;if(id.indexOf("tf_")===0){tfId=tfId.substring(3)}if(restData&&restData.objectSummaries.hasOwnProperty(tfId)){objectSummary=restData.objectSummaries[tfId]}return objectSummary}function getDisplayFields(ctfObj){var ctfUrl=tfUtil.getVal("ctfUrl");var imgLoc=tfUtil.getVal("imageLocation");var isCommitObj=ctfObj.objectType==="CommitSummary"||ctfObj.teamForgeId&&ctfObj.teamForgeId.indexOf("cmmt")===0;var isBuildObj=ctfObj.objectType==="BuildSummary";var isWorkItemObj=ctfObj.objectType==="WorkItemSummary"||ctfObj.teamForgeId&&ctfObj.teamForgeId.indexOf("artf")===0;var isReviewObj=ctfObj.objectType==="ReviewRequestSummary";var linkLabel=null;var typeSpecificFields=null;if(isCommitObj){linkLabel="seeCommit";typeSpecificFields=getCommitSpecificFields(ctfObj)}else if(isBuildObj){linkLabel="seeBuildResults";typeSpecificFields=getBuildSpecificFields(ctfObj)}else if(isReviewObj){linkLabel="seeReviewRequest"}else if(ctfObj.teamForgeId){linkLabel="jumpTo";if(isWorkItemObj){typeSpecificFields=getWorkItemSpecificFields(ctfObj)}}else if(isWorkItemObj){linkLabel="seeWorkItem";typeSpecificFields=getWorkItemSpecificFields(ctfObj)}else{linkLabel="seeActivity";typeSpecificFields=getCustomFields(ctfObj)}var result={fields:[],sourceIcon:ctfObj.__icon_url,id:ctfObj.remoteId||ctfObj.teamForgeId||ctfObj.id,sourceName:ctfObj.objectTypeSourceName,linkLabel:i18n.translate(linkLabel),link:ctfObj.__remote_link};if(!(isCommitObj||isReviewObj)){var summary=ctfObj.title;result.fields.push([i18n.translate("summary"),summary])}var byFieldLabel=null;if(isReviewObj||isBuildObj){byFieldLabel="initiatedBy"}else{byFieldLabel="by"}result.fields.push([i18n.translate(byFieldLabel),ctfObj.createdBy]);result.fields.push([i18n.translate("at"),ctfObj.__display_date+" "+ctfObj.__display_time]);var statusName=tfUtil.getStatusNameFromObject(ctfObj);if(statusName){result.fields.push([i18n.translate("status"),statusName])}var statusClass=tfUtil.getStatusFromObject(ctfObj);if(!statusClass){statusClass="success"}if(statusClass){result.statusIcon=tfUtil.getStatusIcon(statusClass);result.statusColor=tfUtil.getStatusColor(statusClass)}if(typeSpecificFields){for(var fieldInd in typeSpecificFields){result.fields.push(typeSpecificFields[fieldInd])}}return result}function getCommitSpecificFields(ctfObj){var fields=[];fields.push([i18n.translate("comment"),ctfObj.description]);return fields}function getWorkItemSpecificFields(ctfObj){var fields=[];if(ctfObj.customData){if(ctfObj.customData.hasOwnProperty("priority")){fields.push([i18n.translate("priority"),ctfObj.customData.priority])}}return fields}function getBuildSpecificFields(ctfObj){var fields=[];if(ctfObj.customData){if(ctfObj.customData.hasOwnProperty("duration")){fields.push([i18n.translate("duration"),ctfObj.customData.duration+" "+i18n.translate("seconds")])}var results="";var countTypes=["ignored","failed","passed"];countTypes.forEach(function(type){var field="test_results_"+type+"_count";if(ctfObj.customData.hasOwnProperty(field)){var count=+ctfObj.customData[field];if(count>0){results+=count+" "+i18n.translate(type)+". "}}});fields.push([i18n.translate("results"),results])}return fields}function getCustomFields(ctfObj){var fields=[];if(ctfObj.customData){for(var field in ctfObj.customData){fields.push([tfUtil.getCustomNameFromFieldName(field),ctfObj.customData[field]])}}return fields}function unregisterListeners(){var switchOffListener;while(switchOffListener=levelListeners.pop()){switchOffListener()}alreadyListened={}}}})();(function(){var app=angular.module("tfTraceability");app.directive("tfTraceabilitySummary",["$q","tfI18nService","tfQueryService","tfUtilService","tfRestApiService","$compile",tfSummaryImplementation]);function tfSummaryImplementation($q,i18n,tfQueryService,tfUtil,tfRestApiService,$compile){var paginationSpan,pageSizeSpan,pageSize,traceSummaryPagination,elementCount;return{link:linkFunc,restrict:"E",scope:{token:"@",sourcetype:"@",remotesource:"@",remoteid:"@",ctfurl:"@",dateformat:"@",disableorc:"@",timeformat:"@",timezone:"@",svgwidth:"@",svgheight:"@",nextpageicon:"@",previouspageicon:"@",includectfassociations:"@",showspinner:"@"},template:'<div id="tf-is-max-ctf-results"></div>'+'<div class="tf-associations-summary">'+'<svg height="200px">'+'<g class="levels" id="tf-summary-levels">'+"<defs></defs>"+'<tf-traceability-level activity="summary" level="0" '+'includectfassociations="{{includectfassociations}}"></tf-traceability-level>'+'<tf-traceability-level activity="summary" level="1" show="typecount"></tf-traceability-level>'+"</g>"+"</svg>"+"</div>"+'<div class="tf-associations-spinner">'+"<i ng-if=\"showspinner == 'true' && !associationsReady\" "+'     class="fa fa-spinner fa-spin fa-lg"></i>'+"</div>"+'<span class="page-size-component pull-right"'+'data-cookie-name="paginationCookieName" '+'data-on-page-size-change="onPageSizeChange(size)" '+'data-page-size-meta="pageSizeMeta" '+'data-tooltip-placement="top" data-tooltip="" '+"data-i18n-attr=\"{'tooltip': 'Page Size'}\" "+'ng-show="associationsReady"></span>'+'<span class="pagination-component" '+'data-on-init="setPaginationObject(pagination)" '+'data-previous-page-icon="{{previouspageicon}}"'+'data-next-page-icon="{{nextpageicon}}"'+'ng-show="associationsReady"></span>',controller:["$scope",function($scope){tfQueryService.clearCache();$scope.setPaginationObject=function(pagination){traceSummaryPagination=pagination;pagination.setPageSize(pageSize||15,elementCount||1);pagination.setCallBackFunction(paginateCallback)};$scope.paginationCookieName="tfTraceabilitySummaryPageSize";$scope.onPageSizeChange=function(size){pageSize=size;if(traceSummaryPagination){traceSummaryPagination.setPageSize(size,elementCount)}};$scope.pageSizeMeta=[{label:"15",value:15},{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{type:"divider"},{label:"All",value:-1}];$scope.refreshAssocTable=function(nodeGroup){renderAssociationTable($scope,nodeGroup)}}]};function linkFunc(scope,element,attr){if(scope.dateformat)tfUtil.setDateFormat(scope.dateformat);if(scope.timeformat)tfUtil.setTimeFormat(scope.timeformat);if(scope.timezone)tfUtil.setTimeZone(scope.timezone);var ev0=tfUtil.makeKeyForLevelN(tfQueryService,scope,0);var ev1=tfUtil.makeKeyForLevelN(tfQueryService,scope,1);scope.$on(ev0,function(event,dataAvailable){scope.dataAvailable=dataAvailable});scope.$on(ev1,function(event,dataAvailable){if(!ev1)return;var rawsvgelement=element.find("svg")[0];var d3svg=d3.select(rawsvgelement);var rawsvggroupelement=element.find("g")[0];var d3svggroup=d3.select(rawsvggroupelement);if(!scope.dataAvailable)scope.svgheight="1px";tfUtil.configureSizeInSVG(d3svg,scope.svgwidth,scope.svgheight);renderAssociationTable(scope);if(tfUtil.getVal("isMaxCtfResults")){d3.select("#tf-is-max-ctf-results").classed("alert alert-info",true).style("clear","right").text(i18n.translate("limitExceeded"))}})}function paginateCallback(page,pageSize,blockSize){var rows=d3.selectAll("table.tf-associations-list tr");if(pageSize>0){var minView=(page-1)*pageSize;var maxView=minView+pageSize;rows.style({display:function(d,i){return i===0||minView<i&&i<=maxView?null:"none"}})}else{rows.style("display",null)}}function renderAssociationTable(scope,nodeGroup){var ctfUrl=scope.ctfurl;var columnIndex=0;var iCheckbox=columnIndex++,iDate=columnIndex++,iBy=columnIndex++,iType=columnIndex++,iId=columnIndex++,iSource=columnIndex++,iStatus=columnIndex++,iComment=columnIndex++,iSummary=columnIndex++;var checkboxIds=[];var templateKeysColHeadings=["","date","by","","id","source","status","","summary"];var columns=[];var columnCssNames=["checkbox","date","by","typeicon","id","source","status","comment","summary"];var allAssociations=null;var objectId=null;var restResult=tfQueryService.getRestResponse();var objectSummary=[];if(restResult){var zeroLevelIds=restResult.getLevelIds(0);if(zeroLevelIds&&zeroLevelIds.length>0){objectId=zeroLevelIds[0]}objectSummary=restResult.objectSummaries[objectId]}pageSizeSpan=d3.select(".page-size-component").remove().node();paginationSpan=d3.select(".pagination-component").remove();paginationSpan.classed("controls col-md-6",true);paginationSpan=paginationSpan.node();var wrapper=d3.select(".tf-associations-summary");wrapper.select(".assoc-table").remove();scope.associationsReady=true;if(restResult&&restResult.associations.hasOwnProperty(objectId)){allAssociations=restResult.associations[objectId]}var associations=null;if(allAssociations){if(allAssociations.hasOwnProperty("genericAssociations")){associations=allAssociations.genericAssociations}}var associatedToObjects=[];if(associations){if(nodeGroup){for(var associatedToId in nodeGroup){associatedToObjects.push(restResult.objectSummaries[associatedToId])}}else{for(var associatedToId in associations){associatedToObjects.push(restResult.objectSummaries[associatedToId])}}associatedToObjects.sort(function(a,b){if(a&&a.createdDate&&b&&b.createdDate){return new Date(b.createdDate)-new Date(a.createdDate)}return 0})}var tableRows=[];angular.forEach(associatedToObjects,function(d){var associationData=associations[d.id];if(associationData.hasOwnProperty("infos")){var infos=associationData.infos;angular.forEach(infos,function(ai){tableRows.push(getObjectDisplayColumns(d,objectSummary,ai,scope))})}else{tableRows.push(getObjectDisplayColumns(d,objectSummary,associationData,scope))}});elementCount=tableRows.length;if(!tfUtil.getVal("isMaxCtfResults")){d3.select("#associations .tab-items-count").text(elementCount)}wrapper=wrapper.append("div").classed("assoc-table",true);var isEditable=tfQueryService.isEditableAssociations(objectSummary);if(isEditable){var formDiv=wrapper.append("div").classed("widgets-form",true);var form=formDiv.append("form").classed("forms form-horizontal",true);form.attr("name","associationListForm");wrapper=form}var div=wrapper.append("div").classed("tf-associations-list",true);if(pageSizeSpan){div.append(function(){return pageSizeSpan})}var tab=div.append("table").classed("tf-associations-list",true);var tr=tab.append("tr");angular.forEach(templateKeysColHeadings,function(columnName){var colName=i18n.translate(columnName);columns.push(colName=="???"?"":colName)});tr=tr.selectAll("th").data(columns).enter().append("th").attr("class",function(d,i){return"tf-associations-col-"+columnCssNames[i]}).html(function(d,i){if(i===iCheckbox&&isEditable){return'<input type="checkbox"'+' class="associations-checkbox" value="all'+'" onclick="this.form.toggleAllCheckboxes(this)" '+'name="_listItemsAll" title="'+i18n.translate("selectAll")+'" />'}return d});tr=tab.selectAll("tr.dont-skip-row").data(tableRows).enter().append("tr");tr.style("display","none");tr.selectAll("td").data(function(d){return tableRows.pop()}).enter().append("td").attr("class",function(d,i){return"tf-associations-col-"+columnCssNames[i]}).html(function(d,i){if(i===iId&&d.indexOf(" ~ ")>0){var linkStr="";var objUrls=d.split(" # ");if(objUrls&&objUrls.length>0){objUrls.forEach(function(objUrl){var linkRev=objUrl.split(" ~ ");var link=linkRev.shift();if(!tfUtil.startsWith(link,"http")){var linkPath=link;if(linkPath.indexOf("sf/")<0){if(!tfUtil.startsWith(linkPath,"go/")){linkPath="go/"+linkPath}linkPath="sf/"+linkPath}if(!tfUtil.startsWith(linkPath,"/")&&!tfUtil.endsWith(ctfUrl,"/")){linkPath="/"+linkPath}link=ctfUrl+linkPath}var linkLabel=linkRev.length>1?linkRev.join(" ~ "):linkRev[0];if(linkStr.length>0){linkStr+="&nbsp;";if(linkLabel.indexOf("Version")!==-1){linkStr+='<i class="fa fa-arrow-right" aria-hidden="true"></i>&nbsp;'}else{linkStr+=":&nbsp;"}}var aLink='<a onclick="event.stopPropagation();" href="'+link+'">'+linkLabel+"</a>";linkStr+=aLink})}return linkStr}else if(i===iType){return'<img src="'+d+'"/>'}else if(i===iStatus){var icon="";var statusIcon=tfUtil.getStatusIcon(d);if(statusIcon){var fontColor=tfUtil.getStatusColor(d);icon='<span class="fa fa-fw" style="color:'+fontColor+';">'+statusIcon+"&nbsp;</span>"}return icon+d}else if(i===iCheckbox){if(d&&isEditable){var id="checkbox-"+d;checkboxIds.push(id);return'<input type="checkbox" id="'+id+'" class="associations-checkbox" value="'+d+'" onclick="this.form.toggleButtons(this)" '+'name="_listItem" title="'+i18n.translate("select")+" "+d+" "+i18n.translate("association")+'" />'}return""}else if(i===iComment){return d?'<a title="'+tfUtil.htmlEncode(d)+'"><i class="fa fa-comment-o fa-fw"></i></a>':""}else{return tfUtil.htmlEncode(d)}});tr.selectAll(".tf-associations-col-summary, .tf-associations-col-id").on("mouseenter",function(){var $this=d3.select(this);if(this.offsetWidth<this.scrollWidth&&!$this.attr("title")){$this.attr("title",$this.text())}});if(checkboxIds.length===0){tab.selectAll(".tf-associations-col-checkbox").style("display","none")}var formFooter=wrapper.append("div").classed("form-footer clearfix",true);paginationSpan=$compile(paginationSpan)(scope)[0];if(paginationSpan){formFooter.append(function(){return paginationSpan})}if(traceSummaryPagination.getMaxPage()>1&&pageSize>0){paginateCallback(1,traceSummaryPagination.getPageSize(),traceSummaryPagination.getBlockSize())}else{tab.selectAll("tr").style("display",null)}if(isEditable){var removeBtnText=i18n.translate("remove");var addBtnText=i18n.translate("add");var controlDiv=formFooter.append("div").classed("controls col-md-6 text-right",true);var span=controlDiv.append("span");var buttonSpan=span.append("span").classed("widgets-btn-grouped",true);var removeButton=buttonSpan.append("button").classed("btn btn-info",true);removeButton.attr("type","button").attr("disabled",true);removeButton.attr("data-ng-attr-qa-name","removeAssociationBtn");removeButton.text(removeBtnText);removeButton.on("click",function(event){if(!confirm(i18n.translate("confirmDel"))){checkboxIds.forEach(function(id){var checkbox=document.getElementById(id);checkbox.checked=false});return false}removeButton.attr("disabled",true);removeButton.text(i18n.translate("removingAssociation"));var ids=[];checkboxIds.forEach(function(id){var checkbox=document.getElementById(id);if(checkbox.checked){ids.push(checkbox.value)}});if(ids.length>0){removeAssociations(objectSummary,ids,scope)}return false});buttonSpan=span.append("span").classed("widgets-btn-grouped",true);var addButton=buttonSpan.append("button").classed("btn btn-info",true);addButton.attr("type","button");addButton.attr("data-ng-attr-qa-name","addAssociationBtn");addButton.on("click",function(){var objSummary=restResult.objectSummaries[objectId];if(objSummary.path){var addUrl=tfUtil.getMassagedUrl(scope.ctfurl,"/sf/sfmain/do/addAssociation/");NewWindow(addUrl+objSummary.path,"association",650,590,"yes")}});window.finishAssociation=function(){removeButton.attr("disabled",true);addButton.attr("disabled",true);addButton.text(i18n.translate("addingAssociation"));tfQueryService.clearCache();tfUtil.fetchLevelN(tfQueryService,scope,0)};addButton.text(addBtnText);var formNode=wrapper.node();formNode.toggleButtons=function(){var isDisabled=true;for(var i=0;i<checkboxIds.length&&isDisabled;i++){if(document.getElementById(checkboxIds[i]).checked){isDisabled=false}}removeButton.attr("disabled",isDisabled?true:null)};formNode.toggleAllCheckboxes=function(allCheckbox){var isChecked=allCheckbox.checked;checkboxIds.forEach(function(id){document.getElementById(id).checked=isChecked});formNode.toggleButtons()}}}function removeAssociations(item,ids,scope){tfRestApiService.removeAssociations(getCtfObjectId(item),ids,scope).then(function(errorMsg){if(errorMsg){alert(errorMsg)}tfQueryService.clearCache();tfUtil.fetchLevelN(tfQueryService,scope,0)}).catch(function(error){tfQueryService.clearCache();tfUtil.fetchLevelN(tfQueryService,scope,0);alert(i18n.translate("removeAssociationAlert"))})}function getCtfObjectId(item){var objId=null;if(item.teamForgeId){objId=item.teamForgeId}return objId}function NewWindow(mypage,myname,w,h,scroll){var leftPosition=screen.width?(screen.width-w)/2:0;var topPosition=screen.height?(screen.height-h)/2:0;var settings="height="+h+",width="+w+",top="+topPosition+",left="+leftPosition+",scrollbars="+scroll+",resizable=yes";var win=window.open(mypage,myname,settings);if(win!==null){win.focus()}}function getObjectDisplayColumns(targetObjectSummary,originObjectSummary,asscInfo,scope){var mapper={BuildSummary:getBuildColumns};if(mapper[targetObjectSummary.objectType]){return mapper[targetObjectSummary.objectType](targetObjectSummary)}return getTeamForgeColumns(targetObjectSummary,originObjectSummary,asscInfo,scope)}function getBuildColumns(targetObjectSummary){var summary="";if(targetObjectSummary.customData){if(targetObjectSummary.customData.hasOwnProperty("duration")){summary+="Duration: "+targetObjectSummary.customData.duration+" seconds. "}var results="Test results: ",resultsPopulated=false;var countTypes=["ignored","failed","passed"];countTypes.forEach(function(type){var field="test_results_"+type+"_count";if(targetObjectSummary.customData.hasOwnProperty(field)){var testResultCount=+targetObjectSummary.customData[field];if(testResultCount>0){results+=testResultCount+" "+type+". ";resultsPopulated=true}}});if(resultsPopulated)summary+=results}return[null,targetObjectSummary.__display_date,targetObjectSummary.createdBy,targetObjectSummary.__icon_url,getLink(targetObjectSummary),targetObjectSummary.objectTypeSourceName,tfUtil.getStatusNameFromObject(targetObjectSummary),"",summary]}function getTeamForgeColumns(targetObjectSummary,originObjectSummary,asscInfo){var summary=targetObjectSummary.title;if(!summary){summary=targetObjectSummary.description}var ctfId=targetObjectSummary.teamForgeId;var linkName=ctfId;if(tfUtil.startsWith(ctfId,"cmmt")){linkName=targetObjectSummary.remoteId;var log=targetObjectSummary.description;if(log){if(log.length>80){log=log.substring(0,80)}summary=log}}var comment=null;if(asscInfo&&asscInfo.description&&asscInfo.description!==summary){comment=asscInfo.description}if(!comment){comment=""}var projectName=targetObjectSummary.tfProjectName;var sourceName=targetObjectSummary.objectTypeSourceName;if(targetObjectSummary.teamForgeId){if(projectName){sourceName=projectName+": "+sourceName}else{sourceName="TeamForge: "+sourceName}}var link=getLink(targetObjectSummary,linkName);var checkboxValue=asscInfo&&asscInfo.editable?ctfId:null;if(asscInfo){if(asscInfo.hasOwnProperty("targetVersionInfo")){var tvi=asscInfo.targetVersionInfo;if(tvi.hasOwnProperty("url")){link=link+" # "+tvi.url+" ~ Version "+tvi.version}if(checkboxValue){checkboxValue=tvi.ctfId}}if(asscInfo.hasOwnProperty("originVersionInfo")){var ovi=asscInfo.originVersionInfo;if(ovi.hasOwnProperty("url")){if(originObjectSummary){var originLink=getLink(originObjectSummary,getCtfObjectId(originObjectSummary));if(originLink){link=link+(" # "+originLink)}}if(ovi.hasOwnProperty("ctfId")){if(checkboxValue){checkboxValue=ovi.ctfId+"_"+checkboxValue}}link=link+(" # "+ovi.url+" ~ Version "+ovi.version)}}}return[checkboxValue,targetObjectSummary.__display_date,targetObjectSummary.createdBy,targetObjectSummary.__icon_url,link,sourceName,tfUtil.getStatusNameFromObject(targetObjectSummary),comment,summary]}function getLink(obj,label){var link=label;if(!link){link=obj.remoteId}if(obj.__remote_link&&!obj.deleted){link=obj.__remote_link+" ~ "+link}return link}}})();(function(){angular.module("tfTraceability").directive("tfTraceabilityTimeaxis",["tfQueryService","tfUtilService",tfTraceabilityTimeaxisImplementation]);function tfTraceabilityTimeaxisImplementation(tfQueryService,tfUtil){return{templateNamespace:"svg",type:"svg",link:linkFunc,restrict:"E",template:"<g>"+'<g class="axislines">'+'<path d="M0 4 L100000 0" stroke="#D5DCDD" stroke-width="1px" fill="none"/>'+'<path d="M0 35 L99990 35" stroke="#D5DCDD" stroke-width="1px" fill="none"/>'+'<path d="M0 70 L100000 70" stroke="#D5DCDD" stroke-width="1px" fill="none"/>'+"</g>"+'<g class="dates" id="tf-explore-dates">'+"</g>"+"</g>",scope:true,replace:true,controller:["$scope","$attrs",timeaxisController],controllerAs:"timeaxisScope"};function linkFunc(scope,element,attrs){scope.$watch("timeaxisScope.orcData",function(newVal,oldVal){if(!newVal)return;angular.element(element.children()[1]).children().remove();var hostTag=element.children()[1];var d3svg=d3.select(hostTag);["post_origin","pre_origin"].forEach(function(param){var temp_array=[];for(var key in newVal[param]){temp_array.push(key)}temp_array.sort(function(a,b){return new Date(a)-new Date(b)});var prevDate;temp_array.forEach(function(date){var dateSplitUp=date.split(" ");var monthScaleValue;var currentDate=new Date(date);if(prevDate===undefined||prevDate.getFullYear()!=currentDate.getFullYear()){prevDate=new Date(date);monthScaleValue=dateSplitUp[0].toUpperCase()+" '"+dateSplitUp[2].slice(-2)}else if(prevDate.getMonth()!=currentDate.getMonth()){monthScaleValue=dateSplitUp[0].toUpperCase()}else{monthScaleValue=""}if(monthScaleValue){d3svg.append("text").classed("tf-calendar-icon",true).attr("font-family","FontAwesome").attr("font-size","13px").attr("x",newVal[param][date]-25).attr("y",23).text("")}d3svg.append("text").attr("id",param+date).classed("tf-calendar-mmyy",true).attr("x",newVal[param][date]-10).attr("y",23).attr("fill","#0D171A").text(monthScaleValue);d3svg.append("text").classed("tf-calendar-dd",true).attr("x",newVal[param][date]-5).attr("y",55).attr("fill","#0D171A").text(function(){if(dateSplitUp[1].length===1){return"0"+dateSplitUp[1]}else{return dateSplitUp[1]}});prevDate=new Date(date)})})},true)}function timeaxisController($scope,$attrs){var timeaxisScope=this;$scope.$on("timeaxisdata",function(event,data){timeaxisScope.orcData=data})}}})();